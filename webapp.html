<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daggerheart</title>
    <script src="https://telegram.org/js/telegram-web-app.js?57"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            padding: 16px;
            min-height: 100vh;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 10px;
        }

        .title {
            font-size: 24px;
            font-weight: bold;
            color: var(--tg-theme-button-color, #0088cc);
            margin-bottom: 8px;
        }

        .subtitle {
            color: var(--tg-theme-hint-color, #666666);
            font-size: 14px;
        }

        .card {
            background: var(--tg-theme-secondary-bg-color, #f7f7f7);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 8px;
            border: 1px solid var(--tg-theme-section-separator-color, #e1e1e1);
        }

        .button {
            display: block;
            width: 100%;
            padding: 12px 16px;
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            margin-bottom: 8px;
            transition: opacity 0.2s;
        }

        .button:hover {
            opacity: 0.8;
        }

        .button.secondary {
            background: var(--tg-theme-secondary-bg-color, #f7f7f7);
            color: var(--tg-theme-text-color, #000000);
            border: 1px solid var(--tg-theme-section-separator-color, #e1e1e1);
        }

        .hidden {
            display: none !important;
        }

        .character-card {
            display: flex;
            gap: 16px;
            margin-bottom: 8px;
            align-items: flex-start;
        }

        .character-portrait {
            flex-shrink: 0;
            margin-top: 30px; 
        }

        .character-portrait img {
            width: 110px;
            height: 110px;
            border-radius: 50%;
            border: 3px solid var(--tg-theme-button-color, #0088cc);
            object-fit: cover;
            background: var(--tg-theme-secondary-bg-color, #f7f7f7);
        }

        .character-info {
            flex: 1;
            min-width: 0;
        }

        .form-group {
            margin-bottom: 0px;
        }

        .form-label {
            display: block;
            margin-top: 3%;
            margin-bottom: 2%;
            font-weight: 500;
            color: var(--tg-theme-text-color, #000000);
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--tg-theme-section-separator-color, #e1e1e1);
            border-radius: 8px;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            font-size: 16px;
        }

        .gender-row-wrapper {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 0px;
            margin-right: 28px;
        }

        .gender-selector {
            display: flex;
            flex-direction: row;
            gap: 8px;
            justify-content: center;
            align-items: center;
            width: 100%;  
        }

        .gender-slot {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            padding: 0px;
            background: none;
            border: none;
            border-radius: 8px;
            min-width: 90px;
            max-width: 90px;
            width: 90px; 
            box-sizing: border-box;
            margin-right: 28px;
        }

        .gender-slot .stat-label {
            font-size: 16px;
            font-weight: 500;
            color: var(--tg-theme-text-color, #000000);
            text-align: center;
            line-height: 1.2;
            max-width: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-bottom: 2px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            padding: 11px 16px;
            border-radius: 8px;
            border: 1px solid var(--tg-theme-section-separator-color, #e1e1e1);
            background: var(--tg-theme-bg-color, #ffffff);
            transition: all 0.2s;
        }

        .radio-option:hover {
            background: var(--tg-theme-section-bg-color, #f0f0f0);
        }

        .radio-option input[type="radio"] {
            margin: 0;
        }

        .info-button {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            margin-left: 8px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 16px 0;
        }

        .stat-item {
            text-align: center;
            padding: 5px;
            background: var(--tg-theme-section-bg-color, #f0f0f0);
            border-radius: 8px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--tg-theme-text-color, #000000);
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--tg-theme-text-color, #000000);
        }

        .stat-value[readonly] {
            background: var(--tg-theme-section-bg-color, #f0f0f0);
            border: 1px solid var(--tg-theme-section-separator-color, #e1e1e1);
            border-radius: 6px;
            padding: 8px;
            text-align: center;
            width: 100%;
            box-sizing: border-box;
            color: var(--tg-theme-text-color, #000000);
            display: flex;
            align-items: center;
            justify-content: center;
        }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: var(--tg-theme-bg-color, #ffffff);
            margin: 10% auto;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--tg-theme-text-color, #000000);
        }

        .close-button {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--tg-theme-hint-color, #666666);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-button:hover {
            color: var(--tg-theme-text-color, #000000);
        }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ–Ω—á–∏–∫–æ–≤ */
    
        .notification-modal {
            display: none;
            position: fixed;
            z-index: 1500;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            animation: fadeIn 0.3s ease;
        }

        .notification-content {
            background-color: var(--tg-theme-bg-color, #ffffff);
            margin: 20% auto;
            padding: 24px;
            border-radius: 16px;
            width: 85%;
            max-width: 350px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }

        .notification-title {
            font-size: 20px;
            font-weight: bold;
            color: var(--tg-theme-button-color, #0088cc);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .notification-text {
            color: var(--tg-theme-text-color, #000000);
            line-height: 1.5;
            margin-bottom: 20px;
            font-size: 16px;
        }

        .notification-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .notification-button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s;
            min-width: 100px;
        }

        .notification-button.primary {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
        }

        .notification-button.secondary {
            background: var(--tg-theme-secondary-bg-color, #f7f7f7);
            color: var(--tg-theme-text-color, #000000);
            border: 1px solid var(--tg-theme-section-separator-color, #e1e1e1);
        }

        .notification-button:hover {
            opacity: 0.8;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateY(-20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .donut-icon {
            display: inline-block;
            font-size: 18px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫—É—Ä—Å–æ—Ä–∞ –ø–æ–Ω—á–∏–∫–æ–≤ */
        .stat-value[readonly] {
            background: var(--tg-theme-section-bg-color, #f0f0f0);
            border: 1px solid var(--tg-theme-section-separator-color, #e1e1e1);
            border-radius: 6px;
            padding: 8px;
            text-align: center;
            width: 100%;
            box-sizing: border-box;
            color: var(--tg-theme-text-color, #000000);
            cursor: pointer; /* –î–æ–±–∞–≤–ª—è–µ–º –∫—É—Ä—Å–æ—Ä —É–∫–∞–∑–∞—Ç–µ–ª—å */
        }

        .stat-value[readonly]:hover {
            background: var(--tg-theme-section-separator-color, #e1e1e1);
            transition: background 0.2s ease;
        }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –±—Ä–æ—Å–∫–∞ –∫—É–±–∏–∫–æ–≤ */

        .dice-container {
            display: flex;
            gap: 16px;
            justify-content: center;
            margin: 24px 0;
        }

        .dice {
            width: 80px;
            height: 80px;
            background: linear-gradient(145deg, #f0f0f0, #d0d0d0);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            color: #333;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .dice.hope {
            background: linear-gradient(145deg, #4CAF50, #388E3C);
            color: white;
        }

        .dice.fear {
            background: linear-gradient(145deg, #F44336, #D32F2F);
            color: white;
        }

        .dice.rolling {
            animation: roll 0.5s ease-in-out;
        }

        @keyframes roll {
            0%, 100% { transform: rotateY(0deg); }
            50% { transform: rotateY(180deg); }
        }

        .roll-result {
            text-align: center;
            padding: 20px;
            margin: 16px 0;
            border-radius: 12px;
            font-weight: bold;
        }

        .roll-result.success {
            background: #E8F5E8;
            color: #2E7D32;
            border: 2px solid #4CAF50;
        }

        .roll-result.failure {
            background: #FFEBEE;
            color: #C62828;
            border: 2px solid #F44336;
        }

        .roll-result.critical {
            background: #FFF3E0;
            color: #E65100;
            border: 2px solid #FF9800;
        }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∞–≤–∏–ª –∏ –≥–∏–ø–µ—Ä—Å—Å—ã–ª–æ–∫ */
        .rules-link {
            color: var(--tg-theme-link-color, #0088cc);
            text-decoration: underline;
            cursor: pointer;
            font-style: italic;
        }

        .rules-link:hover {
            opacity: 0.7;
        }

        .ancestry-description {
            line-height: 1.6;
            margin: 16px 0;
        }

        .ancestry-description strong {
            font-weight: bold;
            color: var(--tg-theme-text-color, #000000);
        }

        .ability-title {
            font-weight: bold;
            margin-top: 8px;
            margin-bottom: 4px;
        }

        .rules-content {
            line-height: 1.5;
        }

        .rules-section {
            margin-bottom: 20px;
            padding: 16px;
            background: var(--tg-theme-section-bg-color, #f0f0f0);
            border-radius: 8px;
        }

        .rules-section h3 {
            margin-bottom: 8px;
            color: var(--tg-theme-text-color, #000000);
        }

        .breadcrumb {
            font-size: 12px;
            color: var(--tg-theme-hint-color, #666666);
            margin-bottom: 16px;
        }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–æ–º–µ–Ω–æ–≤ */
        .class-domains-row {
            display: flex;
            gap: 13px;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .class-group {
            flex: 1;
            margin-bottom: 0;
            margin-top: 0px;
        }

        .domains-group {
            flex-shrink: 0;
            margin-bottom: 0;
        }

        .domains-group .form-label {
            text-align: center;
            width: 100%;
            display: block;
        }

        .domains-container {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 7px;
        }

        .domain-slot {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            padding: 6px;
            background: var(--tg-theme-bg-color, #ffffff);
            border: 1px solid var(--tg-theme-section-separator-color, #e1e1e1);
            border-radius: 8px;
            min-width: 70px;      
            max-width: 70px;
            width: 70px;
            box-sizing: border-box;
        }

        .domain-icon {
            width: 50px;
            height: 50px;
            border-radius: 6px;
            object-fit: cover;
            border-radius: 8px;
            object-fit: contain;
            background: transparent;
            padding: 4px;
            box-sizing: border-box;
        }

        .domain-name {
            font-size: 12px;
            font-weight: 500;
            color: var(--tg-theme-text-color, #000000);
            text-align: center;
            line-height: 1.2;
            max-width: 80px;      
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –∏ —É–∫–ª–æ–Ω–µ–Ω–∏—è */
        .defense-row-wrapper {
            display: flex;
            justify-content: flex-end;
            margin-top: 0;
            margin-bottom: 8px;
            margin-right: 0;
        }

        .defense-row {
            display: flex;
            gap: 8px;
        }

        .defense-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            text-align: center;
            padding: 8px 0;
            background: var(--tg-theme-section-bg-color, #f0f0f0);
            border-radius: 8px;
            min-width: 70px;
        }

        .defense-item .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--tg-theme-text-color, #000000);
            margin-bottom: 2px;
            line-height: 1;
            width: 2.5em;
            text-align: center;
            user-select: none;
            pointer-events: none;
            background: none; 
            border: none; 
            padding: 0;
        }

        .defense-item .stat-label {
            font-size: 12px;
            color: var(--tg-theme-text-color, #000000);
            text-align: center;
            line-height: 1.2;
            max-width: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin: 0;
        }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –≥–µ–Ω–¥–µ—Ä–∞ */
        .background-gender-row {
            display: flex;
            gap: 16px;
            align-items: flex-end;
            margin-bottom: 4px;
        }

        .background-gender-row .gender-slot {
             margin-left: 28px;
        }

        .background-group {
            flex: 1;
            min-width: 0;
        }

    /* –°—Ç–∏–ª–∏ –¥–ª—è —à–∫–∞–ª */
        .track-fields-row {
            display: flex;
            gap: 16px;
            margin-bottom: 12px;
        }

        .track-group {
            flex: 1;
        }

        .track-scale {
            display: flex;
            gap: 3px;
            flex-wrap: wrap;
            justify-content: flex-start;
            align-content: center;
            padding: 8px;
            padding-left: 15px; 
            padding-right: 13px;
            background: #f0f0f0;
            border-radius: 8px;
            border: 1px solid #e1e1e1;
            min-height: 50px;
        }

        .track-box {
            width: 15px;
            height: 15px;
            border: 1px solid #333;
            border-radius: 4px;
            flex-shrink: 0;
            display: inline-block;
        }

        .track-box.filled {
            background-color: #0088cc;
        }

        .track-box.empty {
            background-color: #ffffff;
        }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∞–¥–µ–∂–¥—ã */
        .hope-defense-container {
            display: flex;
            gap: 18px;
            align-items: center;
            width: 100%;
        }

        .hope-track-group {
            flex: 1;
            margin-right: 0;
            margin-left: 0;
            align-self: center;
            width: auto;
            margin-top: -20px;
        }

        .hope-track-group .form-label {
            font-size: 16px;
            color: var(--tg-theme-text-color, #000000);
            text-align: center;
            margin-bottom: 4px;
        }

        .hope-track {
            display: flex;
            gap: 3px;
            flex-wrap: wrap;
            justify-content: center;
            align-content: center; 
            padding: 8px;
            background: #f0f0f0;
            border-radius: 8px;
            border: 1px solid #e1e1e1;
            min-height: 50px;
            box-sizing: border-box;
        }

        .hope-track .track-box {
            width: 15px;
            height: 15px;
            border: 1px solid #333;
            border-radius: 3px;
        }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è */
        .inventory-section {
            margin-bottom: 24px;
        }

        .armor-slot {
            display: flex;
            gap: 16px;
            align-items: flex-start;
            padding: 16px;
            background: var(--tg-theme-section-bg-color, #f0f0f0);
            border-radius: 12px;
            border: 1px solid var(--tg-theme-section-separator-color, #e1e1e1);
        }

        .armor-image {
            width: 100px;
            height: 143px; /* –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ 7:10 */
            border-radius: 8px;
            object-fit: contain; /* –ò–∑–º–µ–Ω—è–µ–º —Å cover –Ω–∞ contain */
            background: var(--tg-theme-bg-color, #ffffff);
            border: 2px solid var(--tg-theme-section-separator-color, #e1e1e1);
            flex-shrink: 0;
            padding: 4px;
            box-sizing: border-box;
        }

        .weapons-section {
            margin-bottom: 24px;
        }

        .weapons-row {
            display: flex;
            gap: 16px;
            justify-content: space-between;
        }

        .weapon-slot {
            flex: 1;
            padding: 16px;
            background: var(--tg-theme-section-bg-color, #f0f0f0);
            border-radius: 12px;
            border: 1px solid var(--tg-theme-section-separator-color, #e1e1e1);
            text-align: center;
        }

        .weapon-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--tg-theme-text-color, #000000);
            margin-bottom: 8px;
        }

        .weapon-image {
            width: 100px;
            height: 177px; /* –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ 9:16 */
            border-radius: 8px;
            object-fit: contain; /* –ò–∑–º–µ–Ω—è–µ–º —Å cover –Ω–∞ contain */
            background: var(--tg-theme-bg-color, #ffffff);
            border: 2px solid var(--tg-theme-section-separator-color, #e1e1e1);
            margin: 0 auto 12px auto;
            display: block;
            padding: 4px;
            box-sizing: border-box;
        }

        .weapon-image.second-hand {
            opacity: 0.25; /* –î–µ–ª–∞–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É –±–ª–µ–¥–Ω–µ–µ */
        }

        .item-stats {
            flex: 1;
            min-width: 0;
        }

        .stat-line {
            font-size: 14px;
            color: var(--tg-theme-text-color, #000000);
            margin-bottom: 4px;
            text-align: left;
        }

        .weapon-slot .stat-line {
            text-align: left;
        }

        .stat-line span {
            font-weight: 500;
            color: var(--tg-theme-button-color, #0088cc);
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏–π –ø—Ä–µ–¥–º–µ—Ç–æ–≤ */
        .stat-line:first-child {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
            color: var(--tg-theme-text-color, #000000);
        }

        .stat-line:first-child span {
            font-weight: bold;
            color: var(--tg-theme-text-color, #000000);
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫—É—Ä—Å–æ—Ä–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö –±—Ä–æ–Ω–∏ –∏ –æ—Ä—É–∂–∏—è */
        .armor-image, .weapon-image {
            cursor: pointer;
            transition: opacity 0.2s ease;
        }

        .armor-image:hover, .weapon-image:hover {
            opacity: 0.8;
        }

    </style>
</head>
<body>
    <div class="container">
        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="main-menu">
            <div class="header">
                <div class="title">‚öîÔ∏è Daggerheart</div>
                <div class="subtitle">–ú–æ–±–∏–ª—å–Ω–∞—è —Ä–æ–ª–µ–≤–∞—è –∏–≥—Ä–∞</div>
            </div>

            <div class="card">
                <button class="button secondary" id="game-button" onclick="startGame()">
                    üéÆ –ò–ì–†–ê
                </button>
                <button class="button" onclick="showCharacterCreation()">
                    üé≠ –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                </button>
            <button class="button secondary" id="session-button" onclick="showSession()">
                üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–∏
            </button>
            <button class="button secondary" onclick="showDiceRoll()">
                üé≤ –ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫–∏
            </button>
                <button class="button secondary" onclick="showRules()">
                    üìö –ü—Ä–∞–≤–∏–ª–∞
                </button>
            </div>
        </div>

        <!-- –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ -->
        <div id="character-creation" class="hidden">
            <div class="header">
                <div class="title">üé≠ –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</div>
            </div>

            <div class="card">
                <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ -->
                <div class="character-card">
                    <div class="character-portrait">
                        <img id="char-portrait" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTEwIiBoZWlnaHQ9IjExMCIgdmlld0JveD0iMCAwIDExMCAxMTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMTEiIGhlaWdodD0iMTEwIiByeD0iNTUiIGZpbGw9IiNGNUY1RjUiLz4KPHN2ZyB4PSIzMCIgeT0iMjUiIHdpZHRoPSI1MCIgaGVpZ2h0PSI2MCI+CiAgPGNpcmNsZSBjeD0iMjUiIGN5PSIyMCIgcj0iMTIiIGZpbGw9IiNERCQiLz4KICA8ZWxsaXBzZSBjeD0iMjUiIGN5PSI0NSIgcng9IjE4IiByeT0iMjAiIGZpbGw9IiNERCQiLz4KPC9zdmc+Cjwvc3ZnPg==" alt="–ü–æ—Ä—Ç—Ä–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞">
                    </div>
                    <div class="character-info">
                        <div class="form-group">
                            <label class="form-label">–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</label>
                            <input type="text" class="form-input" id="char-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" onchange="updatePortrait()">
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                –ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ
                                <button class="info-button" onclick="showBackgroundInfo()" title="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–∏">?</button>
                            </label>
                            <select class="form-select" id="char-background">
                                <option value="">–í—ã–±—Ä–∞—Ç—å</option>
                                <option value="noble">–í–µ–ª–∏–∫–æ—Ä–æ–¥–Ω–æ–µ</option>
                                <option value="military">–í–æ–µ–Ω–Ω–æ–µ</option>
                                <option value="mountain">–ì–æ—Ä–Ω–æ–µ</option>
                                <option value="dogmatic">–î–æ–≥–º–∞—Ç–∏—á–Ω–æ–µ</option>
                                <option value="lost">–ó–∞–±–ª—É–¥—à–µ–µ</option>
                                <option value="nomadic">–ö–æ—á–µ–≤–æ–µ</option>
                                <option value="criminal">–ö—Ä–∏–º–∏–Ω–∞–ª—å–Ω–æ–µ</option>
                                <option value="forest">–õ–µ—Å–Ω–æ–µ</option>
                                <option value="frost">–ú–æ—Ä–æ–∑–Ω–æ–µ</option>
                                <option value="sea">–ú–æ—Ä—Å–∫–æ–µ</option>
                                <option value="scientific">–ù–∞—É—á–Ω–æ–µ</option>
                                <option value="liberated">–û—Å–≤–æ–±–æ–∂–¥—ë–Ω–Ω–æ–µ</option>
                                <option value="underground">–ü–æ–¥–∑–µ–º–Ω–æ–µ</option>
                                <option value="desert">–ü—É—Å—Ç—ã–Ω–Ω–æ–µ</option>
                                <option value="rural">–°–µ–ª—å—Å–∫–æ–µ</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="background-gender-row">
                    <div class="form-group background-group">
                        <label class="form-label">
                            –†–æ–¥–æ—Å–ª–æ–≤–Ω–∞—è 
                            <button class="info-button" onclick="showAncestryInfo()" title="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–æ–¥–æ—Å–ª–æ–≤–Ω–æ–π">?</button>
                        </label>
                        <select class="form-select" id="char-ancestry" onchange="updatePortrait()">
                            <option value="">–í—ã–±—Ä–∞—Ç—å</option>
                            <option value="akvan">–ê–∫–≤–∞–Ω</option>
                            <option value="aeris">–ê—ç—Ä–∏—Å</option>
                            <option value="giant">–í–µ–ª–∏–∫–∞–Ω</option>
                            <option value="galapa">–ì–∞–ª–∞–ø–∞</option>
                            <option value="gnome">–ì–Ω–æ–º</option>
                            <option value="goblin">–ì–æ–±–ª–∏–Ω</option>
                            <option value="dwarf">–î–≤–∞—Ä—Ñ</option>
                            <option value="dragonid">–î—Ä–∞–∫–æ–Ω–∏–¥</option>
                            <option value="ignis">–ò–≥–Ω–∏—Å</option>
                            <option value="infernis">–ò–Ω—Ñ–µ—Ä–Ω–∏—Å</option>
                            <option value="katari">–ö–∞—Ç–∞—Ä–∏</option>
                            <option value="clank">–ö–ª–∞–Ω–∫</option>
                            <option value="orc">–û—Ä–∫</option>
                            <option value="halfling">–ü–æ–ª—É—Ä–æ—Å–ª–∏–∫</option>
                            <option value="ribbet">–†–∏–±–±–µ—Ç</option>
                            <option value="simian">–°–∏–º–∏–∞–Ω</option>
                            <option value="terran">–¢–µ—Ä—Ä–∞–Ω</option>
                            <option value="faun">–§–∞–≤–Ω</option>
                            <option value="fangril">–§–∞–Ω–≥—Ä–∏–ª</option>
                            <option value="faerie">–§–µ–π—Ä–∏</option>
                            <option value="firbolg">–§–∏—Ä–±–æ–ª–≥</option>
                            <option value="human">–ß–µ–ª–æ–≤–µ–∫</option>
                            <option value="elf">–≠–ª—å—Ñ</option>
                            <option value="etheris">–≠—Ñ–∏—Ä–∏—Å</option>
                        </select>
                    </div>
                    <div class="gender-slot">
                        <label class="stat-label">–ì–µ–Ω–¥–µ—Ä</label>
                        <div class="gender-selector">
                            <label class="radio-option">
                                <input type="radio" name="gender" value="male" checked onchange="updatePortrait()">
                                <span>‚ôÇ</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="gender" value="female" onchange="updatePortrait()">
                                <span>‚ôÄ</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="class-domains-row">
                    <div class="form-group class-group">
                        <label class="form-label">
                            –ö–ª–∞—Å—Å
                            <button class="info-button" onclick="showClassInfo()" title="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Å–µ">?</button>
                        </label>
                        <select class="form-select" id="char-class" onchange="updateDomains()">
                            <option value="">–í—ã–±—Ä–∞—Ç—å</option>
                            <option value="bard">–ë–∞—Ä–¥</option>
                            <option value="rogue">–ü–ª—É—Ç</option>
                            <option value="sorcerer">–ß–∞—Ä–æ–¥–µ–π</option>
                            <option value="druid">–î—Ä—É–∏–¥</option>
                            <option value="ranger">–°–ª–µ–¥–æ–ø—ã—Ç</option>
                            <option value="warrior">–í–æ–∏–Ω</option>
                            <option value="guardian">–°—Ç—Ä–∞–∂</option>
                            <option value="seraph">–°–µ—Ä–∞—Ñ–∏–º</option>
                            <option value="wizard">–í–æ–ª—à–µ–±–Ω–∏–∫</option>
                        </select>
                    </div>

                    <div class="form-group domains-group">
                        <label class="form-label">–î–û–ú–ï–ù–´</label>
                        <div class="domains-container">
                            <div class="domain-slot" id="domain-1">
                                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1zbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iNiIgZmlsbD0iI0Y1RjVGNSIvPgo8dGV4dCB4PSIxNiIgeT0iMjEiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iI0RERCIgdGV4dC1hbmN–æ–±3I9Im1pZGRsZSI+PzwvdGV4dD4KPC9zdmc+" alt="–î–æ–º–µ–Ω 1" class="domain-icon">
                                <span class="domain-name">-</span>
                            </div>
                            <div class="domain-slot" id="domain-2">
                                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1zbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iNiIgZmlsbD0iI0Y1RjVGNSIvPgo8dGV4dCB4PSIxNiIgeT0iMjEiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxOCIgZmlsbD0iI0RERCIgdGV4dC1hbmN–æb3I9Im1pZGRsZSI+PzwvdGV4dD4KPC9zdmc+" alt="–î–æ–º–µ–Ω 2" class="domain-icon">
                                <span class="domain-name">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="defense-row-wrapper">
                    <div class="hope-defense-container">
                        <div class="track-group hope-track-group">
                            <label class="form-label">–ù–ê–î–ï–ñ–î–ê</label>
                            <div class="track-scale hope-track" id="hope-track">
                                <div class="track-box filled"></div>
                                <div class="track-box filled"></div>
                                <div class="track-box empty"></div>
                                <div class="track-box empty"></div>
                                <div class="track-box empty"></div>
                                <div class="track-box empty"></div>
                            </div>
                        </div>
                        <div class="defense-row">
                            <div class="defense-item">
                                <div class="stat-value" id="evasion" readonly>0</div>
                                <div class="stat-label">–£–∫–ª–æ–Ω–µ–Ω–∏–µ</div>
                            </div>
                            <div class="defense-item">
                                <div class="stat-value" id="armor" readonly>0</div>
                                <div class="stat-label">–ë—Ä–æ–Ω—è</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="track-fields-row">
                    <div class="track-group">
                        <label class="form-label">–ñ–∏–∑–Ω—å</label>
                        <div class="track-scale" id="life-track">
                            <div class="track-box filled"></div>
                            <div class="track-box filled"></div>
                            <div class="track-box filled"></div>
                            <div class="track-box filled"></div>
                            <div class="track-box filled"></div>
                            <div class="track-box filled"></div>
                            <div class="track-box empty"></div>
                            <div class="track-box empty"></div>
                            <div class="track-box empty"></div>
                            <div class="track-box empty"></div>
                            <div class="track-box empty"></div>
                            <div class="track-box empty"></div>
                        </div>
                    </div>
                    
                    <div class="track-group">
                        <label class="form-label">–î—Ä–∞–º–∞</label>
                        <div class="track-scale" id="drama-track">
                            <div class="track-box filled"></div>
                            <div class="track-box filled"></div>
                            <div class="track-box filled"></div>
                            <div class="track-box filled"></div>
                            <div class="track-box filled"></div>
                            <div class="track-box filled"></div>
                            <div class="track-box empty"></div>
                            <div class="track-box empty"></div>
                            <div class="track-box empty"></div>
                            <div class="track-box empty"></div>
                            <div class="track-box empty"></div>
                            <div class="track-box empty"></div>
                        </div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">–°–∏–ª–∞</div>
                        <input type="number" class="stat-value" id="strength" value="0" min="-3" max="3" readonly onclick="showStatsMessage()">
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">–õ–æ–≤–∫–æ—Å—Ç—å</div>
                        <input type="number" class="stat-value" id="agility" value="0" min="-3" max="3" readonly onclick="showStatsMessage()">
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">–ì—Ä–∞—Ü–∏—è</div>
                        <input type="number" class="stat-value" id="finesse" value="0" min="-3" max="3" readonly onclick="showStatsMessage()">
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">–ò–Ω—Ç—É–∏—Ü–∏—è</div>
                        <input type="number" class="stat-value" id="instinct" value="0" min="-3" max="3" readonly onclick="showStatsMessage()">
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">–•–∞—Ä–∏–∑–º–∞</div>
                        <input type="number" class="stat-value" id="presence" value="0" min="-3" max="3" readonly onclick="showStatsMessage()">
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</div>
                        <input type="number" class="stat-value" id="knowledge" value="0" min="-3" max="3" readonly onclick="showStatsMessage()">
                    </div>
                </div>

                <button class="button" onclick="saveCharacter()">
                    ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                </button>
                <button class="button secondary" onclick="showMainMenu()">
                    ‚Üê –ù–∞–∑–∞–¥
                </button>
            </div>
        </div>

    <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–∏ -->
        <div id="session-state" class="hidden">
            <div class="header">
                <div class="title">üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–∏</div>
            </div>

            <div class="card">

                <div class="form-group">
                    <label class="form-label">üë§ –ú–æ–π –ø–µ—Ä—Å–æ–Ω–∞–∂</label>
                    <div id="character-info">
                        <p>–ü–µ—Ä—Å–æ–Ω–∞–∂ –Ω–µ —Å–æ–∑–¥–∞–Ω</p>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</label>
                    <div id="inventory-info">
                        <p>–ü–µ—Ä—Å–æ–Ω–∞–∂ –Ω–µ —Å–æ–∑–¥–∞–Ω</p>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">üåç –¢–µ–∫—É—â–∞—è —Å—Ü–µ–Ω–∞</label>
                    <div id="current-scene">
                        <p>–°—Ü–µ–Ω–∞ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</p>
                    </div>
                </div>

                <button class="button secondary" onclick="showMainMenu()">‚Üê –ù–∞–∑–∞–¥</button>
            </div>
        </div>

        <!-- –ë—Ä–æ—Å–æ–∫ –∫—É–±–∏–∫–æ–≤ -->
        <div id="dice-roll" class="hidden">
            <div class="header">
                <div class="title">üé≤ –ë—Ä–æ—Å–æ–∫ –∫—É–±–∏–∫–æ–≤</div>
            </div>

            <div class="card">
                <div class="form-group">
                    <label class="form-label">–¢–∏–ø –±—Ä–æ—Å–∫–∞</label>
                    <select class="form-select" id="roll-type">
                        <option value="action">–ë—Ä–æ—Å–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è</option>
                        <option value="attack">–ë—Ä–æ—Å–æ–∫ –∞—Ç–∞–∫–∏</option>
                        <option value="damage">–ë—Ä–æ—Å–æ–∫ —É—Ä–æ–Ω–∞</option>
                        <option value="reaction">–ë—Ä–æ—Å–æ–∫ —Ä–µ–∞–∫—Ü–∏–∏</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞</label>
                    <select class="form-select" id="trait-modifier">
                        <option value="0">–ë–µ–∑ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞</option>
                        <option value="strength">–°–∏–ª–∞</option>
                        <option value="agility">–õ–æ–≤–∫–æ—Å—Ç—å</option>
                        <option value="finesse">–ì—Ä–∞—Ü–∏—è</option>
                        <option value="instinct">–ò–Ω—Ç—É–∏—Ü–∏—è</option>
                        <option value="presence">–•–∞—Ä–∏–∑–º–∞</option>
                        <option value="knowledge">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">–°–ª–æ–∂–Ω–æ—Å—Ç—å</label>
                    <input type="number" class="form-input" id="difficulty" value="12" min="5" max="20">
                </div>

                <div class="dice-container">
                    <div class="dice hope" id="hope-dice">?</div>
                    <div class="dice fear" id="fear-dice">?</div>
                </div>

                <button class="button" onclick="rollDice()" id="roll-button">
                    üé≤ –ë—Ä–æ—Å–∏—Ç—å –∫–æ—Å—Ç–∏ –¥—É–∞–ª—å–Ω–æ—Å—Ç–∏
                </button>

                <div id="roll-result" class="hidden"></div>

                <button class="button secondary" onclick="showMainMenu()">
                    ‚Üê –ù–∞–∑–∞–¥
                </button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª —Å –≥–ª–æ—Å—Å–∞—Ä–∏–µ–º –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π -->
        <div id="rules" class="hidden">
            <div class="header">
                <div class="title">üìö –ü—Ä–∞–≤–∏–ª–∞</div>
            </div>

            <div class="card">
                <div class="breadcrumb" id="rules-breadcrumb">–ü—Ä–∞–≤–∏–ª–∞</div>
                
                <div id="rules-main">
                    <div class="form-group">
                        <label class="form-label">–†–∞–∑–¥–µ–ª—ã –ø—Ä–∞–≤–∏–ª</label>
                        <button class="button secondary" onclick="showRulesSection('distances')">üéØ –î–∏—Å—Ç–∞–Ω—Ü–∏–∏</button>
                        <button class="button secondary" onclick="showRulesSection('combat')">‚öîÔ∏è –ë–æ–π</button>
                        <button class="button secondary" onclick="showRulesSection('glossary')">üìñ –ì–ª–æ—Å—Å–∞—Ä–∏–π</button>
                    </div>
                </div>

                <div id="rules-distances" class="hidden">
                    <div class="rules-content">
                        <h3>üéØ –î–∏—Å—Ç–∞–Ω—Ü–∏–∏</h3>
                        <div class="rules-section">
                            <h4>–í–ø–ª–æ—Ç–Ω—É—é</h4>
                            <p>–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–∂ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏, –ø–æ–∑–≤–æ–ª—è—é—â–µ–º –∫–æ—Å–Ω—É—Ç—å—Å—è —Ü–µ–ª–∏. –ü–µ—Ä—Å–æ–Ω–∞–∂ –º–æ–∂–µ—Ç –∫–æ—Å–Ω—É—Ç—å—Å—è —Ü–µ–ª–∏, –Ω–∞—Ö–æ–¥—è—â–∏–π—Å—è –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ –¥–æ –º–µ—Ç—Ä–∞ –æ—Ç –Ω–µ–≥–æ. –ò–º–µ–π—Ç–µ –≤ –≤–∏–¥—É, —á—Ç–æ –¥–∏—Å—Ç–∞–Ω—Ü–∏—è –í–ø–ª–æ—Ç–Ω—É—é –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –¥–ª—è –æ—Å–æ–±–æ –∫—Ä—É–ø–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π.</p>
                        </div>
                        <div class="rules-section">
                            <h4>–ë–ª–∏–∑–∫–æ</h4>
                            <p>–ö–æ—Ä–æ—Ç–∫–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ø—Ä—è–º–æ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏.</p>
                        </div>
                        <div class="rules-section">
                            <h4>–°—Ä–µ–¥–Ω–µ</h4>
                            <p>–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–∂ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–ª–∏–∑–∫–æ –∫ —Ü–µ–ª–∏, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –µ–µ –≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–µ—Ç–∞–ª—è—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –¥—Ä—É–≥–æ–≥–æ –∫–æ–Ω—Ü–∞ –∫–æ–º–Ω–∞—Ç—ã –∏–ª–∏ —Å–æ—Å–µ–¥–Ω–µ–≥–æ —Ä—ã–Ω–æ—á–Ω–æ–≥–æ –ø—Ä–∏–ª–∞–≤–∫–∞. –≠—Ç–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ –æ—Ç 3 –¥–æ 9 –º–µ—Ç—Ä–æ–≤. –ù–∞—Ö–æ–¥—è—Å—å –≤ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –ø–µ—Ä—Å–æ–Ω–∞–∂ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è –í–ø–ª–æ—Ç–Ω—É—é –∫ –ª—é–±–æ–π —Ü–µ–ª–∏, –Ω–∞—Ö–æ–¥—è—â–µ–π—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –°—Ä–µ–¥–Ω–µ–π –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏, –∫–∞–∫ —á–∞—Å—Ç—å —Å–≤–æ–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è.</p>
                        </div>
                        <div class="rules-section">
                            <h4>–î–∞–ª–µ–∫–æ</h4>
                            <p>–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–∂ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–ª–µ–∫–æ, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –≤–Ω–µ—à–Ω–∏–π –≤–∏–¥ —Ü–µ–ª–∏, –Ω–æ –Ω–µ –¥–µ—Ç–∞–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à–æ–µ –ø–æ–ª–µ –±–æ—è –∏–ª–∏ –≤ –∫–æ–Ω—Ü–µ –±–æ–ª—å—à–æ–≥–æ –∫–æ—Ä–∏–¥–æ—Ä–∞. –≠—Ç–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ –æ—Ç 9 –¥–æ 30 –º–µ—Ç—Ä–æ–≤. –ü–æ–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –ú–∞—Å—Ç–µ—Ä –º–æ–∂–µ—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç—å –µ–≥–æ —Å–æ–≤–µ—Ä—à–∏—Ç—å –±—Ä–æ—Å–æ–∫ –ü—Ä–æ–≤–æ—Ä–Ω–æ—Å—Ç–∏, —á—Ç–æ–±—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è –í–ø–ª–æ—Ç–Ω—É—é –∫ –ª—é–±–æ–π —Ü–µ–ª–∏, –Ω–∞—Ö–æ–¥—è—â–µ–π—Å—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –î–∞–ª–µ–∫–æ–π –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏.</p>
                        </div>
                    </div>
                </div>

                <div id="rules-combat" class="hidden">
                    <div class="rules-content">
                        <h3>‚öîÔ∏è –ë–æ–π</h3>
                        <div class="rules-section">
                            <h4>–†–∞–Ω—ã</h4>
                            <p>–†–∞–Ω—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ –∏ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.</p>
                        </div>
                        <div class="rules-section">
                            <h4>–ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ</h4>
                            <p>–í–∞—à–µ –º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ—Å—Ç–µ–π —É—Ä–æ–Ω–∞ –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∞—Ç–∞–∫–µ.</p>
                        </div>
                        <div class="rules-section">
                            <h4>–û–¥–∏–Ω —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é</h4>
                            <p>–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞ –≥–æ–≤–æ—Ä—è—Ç, —á—Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö "–æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é". –≠—Ç–∏ —Å–≤–æ–π—Å—Ç–≤–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –æ—Ç–¥—ã—Ö–∞, –Ω–æ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –Ω–∞—á–∞–ª–µ –≤–∞—à–µ–π —Å–ª–µ–¥—É—é—â–µ–π —Å–µ—Å—Å–∏–∏ Daggerheart. –ï—Å–ª–∏ –≤–∞—à —Å—Ç–æ–ª —Ä–µ—à–∞–µ—Ç –∏–≥—Ä–∞—Ç—å –≤ –æ–¥–Ω—É –¥–æ–ª–≥—É—é —Å–µ—Å—Å–∏—é, –ú–∞—Å—Ç–µ—Ä –º–æ–∂–µ—Ç —Ä–µ—à–∏—Ç—å, —á—Ç–æ –≤—Å–µ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ "–æ–¥–∏–Ω —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é" –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Ä—ã–≤–∞ –≤ –∏–≥—Ä–µ.</p>
                        </div>
                    </div>
                </div>

                <div id="rules-glossary" class="hidden">
                    <div class="rules-content">
                        <h3>üìñ –ì–ª–æ—Å—Å–∞—Ä–∏–π</h3>
                        <div class="rules-section">
                            <h4>–í</h4>
                            <p><span class="rules-link" onclick="showRulesSection('distances')">–í–ø–ª–æ—Ç–Ω—É—é</span></p>
                        </div>
                        <div class="rules-section">
                            <h4>–î</h4>
                            <p><span class="rules-link" onclick="showRulesSection('distances')">–î–∞–ª–µ–∫–æ</span></p>
                        </div>
                        <div class="rules-section">
                            <h4>–ò</h4>
                            <p><span class="rules-link" onclick="showRulesSection('glossary')">–ò—Å–∫—É—Å–Ω–æ—Å—Ç—å</span></p>
                        </div>
                        <div class="rules-section">
                            <h4>–ú</h4>
                            <p><span class="rules-link" onclick="showRulesSection('combat')">–ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ</span></p>
                        </div>
                        <div class="rules-section">
                            <h4>–ù</h4>
                            <p><span class="rules-link" onclick="showRulesSection('glossary')">–ù–∞–¥–µ–∂–¥–∞</span></p>
                        </div>
                        <div class="rules-section">
                            <h4>–û</h4>
                            <p><span class="rules-link" onclick="showRulesSection('combat')">–û–¥–∏–Ω —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é</span></p>
                        </div>
                        <div class="rules-section">
                            <h4>–†</h4>
                            <p><span class="rules-link" onclick="showRulesSection('combat')">–†–∞–Ω–∞</span></p>
                        </div>
                        <div class="rules-section">
                            <h4>–°</h4>
                            <p><span class="rules-link" onclick="showRulesSection('distances')">–°—Ä–µ–¥–Ω–µ</span></p>
                        </div>
                    </div>
                </div>

                <button class="button secondary" onclick="goBackFromRules()">‚Üê –ù–∞–∑–∞–¥</button>
            </div>
        </div>

        <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
        <div id="inventory" class="hidden">
            <div class="header">
                <div class="title">üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
            </div>

            <div class="card">
                <div class="inventory-section">
                    <label class="form-label">üõ°Ô∏è –ë—Ä–æ–Ω—è</label>
                    <div class="armor-slot">
                        <img id="armor-image" src="" alt="–ë—Ä–æ–Ω—è" class="armor-image" onclick="showInventoryMessage()">
                        <div class="item-stats" id="armor-stats">
                            <div class="stat-line" id="armor-name">–ù–∞–∑–≤–∞–Ω–∏–µ –±—Ä–æ–Ω–∏</div>
                            <div class="stat-line">–ó–∞—â–∏—Ç–∞: <span id="armor-defense">0</span></div>
                            <div class="stat-line">–¢–∏–ø: <span id="armor-type">-</span></div>
                            <div class="stat-line">–ß–µ—Ä—Ç–∞: <span id="armor-trait">-</span></div>
                        </div>
                    </div>
                </div>

                <!-- –ü–æ–ª—è –¥–ª—è –æ—Ä—É–∂–∏—è -->
                <div class="weapons-section">
                    <label class="form-label">‚öîÔ∏è –û—Ä—É–∂–∏–µ</label>
                    <div class="weapons-row">
                        <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ä—É–∫–∞ -->
                        <div class="weapon-slot">
                            <div class="weapon-label">–û—Å–Ω–æ–≤–Ω–∞—è —Ä—É–∫–∞</div>
                            <img id="main-weapon-image" src="" alt="–û—Å–Ω–æ–≤–Ω–æ–µ –æ—Ä—É–∂–∏–µ" class="weapon-image" onclick="showInventoryMessage()">
                            <div class="item-stats" id="main-weapon-stats">
                                <div class="stat-line" id="main-weapon-name">–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä—É–∂–∏—è</div>
                                <div class="stat-line">–£—Ä–æ–Ω: <span id="main-weapon-damage">-</span></div>
                                <div class="stat-line">–¢–∏–ø: <span id="main-weapon-type">-</span></div>
                                <div class="stat-line">–î–∏—Å—Ç.: <span id="main-weapon-range">-</span></div>
                                <div class="stat-line">–ß–µ—Ä—Ç–∞: <span id="main-weapon-trait">-</span></div>
                            </div>
                        </div>

                        <!-- –í—Ç–æ—Ä–∞—è —Ä—É–∫–∞ -->
                        <div class="weapon-slot">
                            <div class="weapon-label">–í—Ç–æ—Ä–∞—è —Ä—É–∫–∞</div>
                            <img id="off-weapon-image" src="" alt="–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–µ –æ—Ä—É–∂–∏–µ" class="weapon-image" onclick="showInventoryMessage()">
                            <div class="item-stats" id="off-weapon-stats">
                                <div class="stat-line" id="off-weapon-name">–ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ä—É–∂–∏—è</div>
                                <div class="stat-line">–£—Ä–æ–Ω: <span id="off-weapon-damage">-</span></div>
                                <div class="stat-line">–¢–∏–ø: <span id="off-weapon-type">-</span></div>
                                <div class="stat-line">–î–∏—Å—Ç.: <span id="off-weapon-range">-</span></div>
                                <div class="stat-line">–ß–µ—Ä—Ç–∞: <span id="off-weapon-trait">-</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="button secondary" onclick="showSession()">‚Üê –ù–∞–∑–∞–¥</button>
            </div>
        </div>

        <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
        <div id="game-screen" class="hidden">
            <div class="header">
                <div class="title">üéÆ Daggerheart</div>
                <div class="subtitle" id="scene-location">–õ–æ–∫–∞—Ü–∏—è –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</div>
            </div>

            <div class="card">
                <!-- –û–±–ª–∞—Å—Ç—å –∏—Å—Ç–æ—Ä–∏–∏ –∏–≥—Ä—ã -->
                <div id="game-log" class="game-log">
                    <div class="gm-message">
                        <strong>–ì–ú:</strong> –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä Daggerheart! –ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è...
                    </div>
                </div>

                <!-- –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è —Ö–æ–¥–æ–≤ –æ—Ç –ì–ú -->
                <div id="action-suggestions" class="action-suggestions hidden">
                    <label class="form-label">–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</label>
                    <div id="suggestions-list"></div>
                </div>

                <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ –¥–µ–π—Å—Ç–≤–∏–π –∏–≥—Ä–æ–∫–∞ -->
                <div class="form-group">
                    <label class="form-label">–í–∞—à–µ –¥–µ–π—Å—Ç–≤–∏–µ:</label>
                    <textarea class="form-input" id="player-action" placeholder="–û–ø–∏—à–∏—Ç–µ —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å..." rows="3"></textarea>
                    <button class="button" onclick="sendPlayerAction()" id="send-action-btn">
                        üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ
                    </button>
                </div>

                <!-- –ü–∞–Ω–µ–ª—å –±—ã—Å—Ç—Ä—ã—Ö –±—Ä–æ—Å–∫–æ–≤ -->
                <div class="quick-rolls">
                    <label class="form-label">–ë—ã—Å—Ç—Ä—ã–µ –±—Ä–æ—Å–∫–∏:</label>
                    <div class="rolls-row">
                        <button class="button secondary small" onclick="quickRoll('strength')">üí™ –°–∏–ª–∞</button>
                        <button class="button secondary small" onclick="quickRoll('agility')">üèÉ –õ–æ–≤–∫–æ—Å—Ç—å</button>
                        <button class="button secondary small" onclick="quickRoll('finesse')">üéØ –ì—Ä–∞—Ü–∏—è</button>
                        <button class="button secondary small" onclick="quickRoll('instinct')">üß† –ò–Ω—Ç—É–∏—Ü–∏—è</button>
                        <button class="button secondary small" onclick="quickRoll('presence')">‚ú® –•–∞—Ä–∏–∑–º–∞</button>
                        <button class="button secondary small" onclick="quickRoll('knowledge')">üìö –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç</button>
                    </div>
                </div>

                <!-- –ü–∞–Ω–µ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ -->
                <div class="character-status">
                    <div class="status-row">
                        <div class="status-item">
                            <span class="status-label">‚ù§Ô∏è –ñ–∏–∑–Ω—å:</span>
                            <span id="current-hp">6</span>/<span id="max-hp">6</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">üé≠ –î—Ä–∞–º–∞:</span>
                            <span id="current-drama">0</span>/12
                        </div>
                        <div class="status-item">
                            <span class="status-label">‚ú® –ù–∞–¥–µ–∂–¥–∞:</span>
                            <span id="current-hope">2</span>/6
                        </div>
                    </div>
                </div>

                <button class="button secondary" onclick="pauseGame()">‚è∏Ô∏è –ü–∞—É–∑–∞</button>
                <button class="button secondary" onclick="endGame()">üö™ –ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É</button>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–æ–¥–æ—Å–ª–æ–≤–Ω—ã—Ö -->
        <div id="ancestry-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="modal-ancestry-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–æ–¥–æ—Å–ª–æ–≤–Ω–æ–π</div>
                    <button class="close-button" onclick="closeAncestryModal()">&times;</button>
                </div>
                <div id="modal-ancestry-description">
                    –í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–¥–æ—Å–ª–æ–≤–Ω—É—é –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∫–ª–∞—Å—Å–æ–≤ -->
        <div id="class-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="modal-class-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Å–µ</div>
                    <button class="close-button" onclick="closeClassModal()">&times;</button>
                </div>
                <div id="modal-class-description">
                    –í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–π -->
        <div id="background-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <div class="modal-title" id="modal-background-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–∏</div>
                    <button class="close-button" onclick="closeBackgroundModal()">&times;</button>
                </div>
                <div id="modal-background-description">
                    –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞—Ö -->
        <div id="stats-notification-modal" class="notification-modal">
            <div class="notification-content">
                <div class="notification-title">
                    üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –≤—ã–±–æ—Ä
                </div>
                <div class="notification-text">
                    –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞.<br><br>
                    –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –∑–∞ –ø–æ–Ω—á–∏–∫–∏ <span class="donut-icon">üç©</span> –≤ –±—É–¥—É—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö!
                </div>
                <div class="notification-buttons">
                    <button class="notification-button primary" onclick="closeStatsNotification()">
                        –ü–æ–Ω—è—Ç–Ω–æ
                    </button>
                </div>
            </div>
        </div>
        
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
        const API_BASE_URL = 'https://ubiquitous-telegram-v4qrrr9j5r437j4-5000.app.github.dev';

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        var currentCharacter = null;
        var sessionData = {
            fear: 0,
            hope: 0,
            scene: '',
            players: []
        };

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
        var gameState = {
            scene: '–ù–∞—á–∞–ª–æ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è',
            location: '–¢–∞–≤–µ—Ä–Ω–∞ "–ó–æ–ª–æ—Ç–æ–π –¥—Ä–∞–∫–æ–Ω"',
            log: []
        };

        // –î–∞–Ω–Ω—ã–µ –æ —Ä–æ–¥–æ—Å–ª–æ–≤–Ω—ã—Ö (–∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏–π)
        var ancestryData = {
            akvan: { 
                name: "–ê–∫–≤–∞–Ω", 
                description: `<p><em>–ê–∫–≤–∞–Ω—ã –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –æ—Ç –≤–æ–¥–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–∞–ª–µ–π. –≠—Ç–æ –≥—É–º–∞–Ω–æ–∏–¥—ã, —á—å–∏ —Ç–µ–ª–∞ —Å–æ—Å—Ç–æ—è—Ç –∏–∑ –ø–ª–æ—Ç–∏ –∏ –≤–æ–¥—ã.</em></p>
                
                <div class="ability-title"><strong>–ò—Å—Ç–æ—á–Ω–∏–∫ –ñ–∏–∑–Ω–∏:</strong></div>
                <p><span class="rules-link" onclick="openRulesLink('combat', 'once-per-session')">–û–¥–∏–Ω —Ä–∞–∑ –∑–∞ —Å–µ—Å—Å–∏—é</span> –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–º–Ω–æ–≥–æ –≤–æ–¥—ã –∏–∑ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–µ–π, —á—Ç–æ–±—ã –∏—Å—Ü–µ–ª–∏—Ç—å —Å–æ—é–∑–Ω–∏–∫–∞, –Ω–∞—Ö–æ–¥—è—â–µ–≥–æ—Å—è <span class="rules-link" onclick="openRulesLink('distances', 'vplotnoyu')">–í–ø–ª–æ—Ç–Ω—É—é</span>. –ö–æ–≥–¥–∞ –≤—ã —ç—Ç–æ –¥–µ–ª–∞–µ—Ç–µ, —Å–Ω–∏–º–∏—Ç–µ 1 <span class="rules-link" onclick="openRulesLink('combat', 'wounds')">–†–∞–Ω—É</span> —É —Ü–µ–ª–∏.</p>
                
                <div class="ability-title"><strong>–í–æ–¥–Ω—ã–π –ö–Ω—É—Ç:</strong></div>
                <p>–í—ã –º–æ–∂–µ—Ç–µ –≤—ã—Ç—è–≥–∏–≤–∞—Ç—å –≤–æ–¥—É –∏–∑ –æ–∫—Ä—É–∂–∞—é—â–µ–π —Å—Ä–µ–¥—ã, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–µ –¥–ª—è –∞—Ç–∞–∫–∏. –°–¥–µ–ª–∞–≤ —ç—Ç–æ, —Å—á–∏—Ç–∞–π—Ç–µ –µ—ë –∫–∞–∫ –æ—Ä—É–∂–∏–µ <span class="rules-link" onclick="openRulesLink('glossary', 'iskusnost')">–ò—Å–∫—É—Å–Ω–æ—Å—Ç–∏</span> —Å–æ <span class="rules-link" onclick="openRulesLink('distances', 'sredne')">–°—Ä–µ–¥–Ω–µ–π</span> –¥–∏—Å—Ç–∞–Ω—Ü–∏–µ–π, –Ω–∞–Ω–æ—Å—è—â–µ–µ d6 –º–∞–≥–∏—á–µ—Å–∫–æ–≥–æ —É—Ä–æ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É—è <span class="rules-link" onclick="openRulesLink('combat', 'masterstvo')">–ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ</span>. –ï—Å–ª–∏ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö <em>–ë–ª–∏–∑–∫–æ–π</em> –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ –æ—Ç –≤–æ–¥–æ–µ–º–∞, –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ—Ç—Ä–∞—Ç–∏—Ç—å <span class="rules-link" onclick="openRulesLink('glossary', 'nadezhda')">–ù–∞–¥–µ–∂–¥—É</span>, —á—Ç–æ–±—ã —É–≤–µ–ª–∏—á–∏—Ç—å –¥–∏—Å—Ç–∞–Ω—Ü–∏—é –∞—Ç–∞–∫–∏ –¥–æ <span class="rules-link" onclick="openRulesLink('distances', 'daleko')">–î–∞–ª—ë–∫–æ–π</span> –∏ –Ω–∞–Ω–µ—Å—Ç–∏ d10 —É—Ä–æ–Ω–∞ –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ.</p>`
            },
            aeris: { 
                name: "–ê—ç—Ä–∏—Å", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ê–≠–†–ò–° - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            giant: { 
                name: "–í–µ–ª–∏–∫–∞–Ω", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–í–ï–õ–ò–ö–ê–ù - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            galapa: { 
                name: "–ì–∞–ª–∞–ø–∞", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ì–ê–õ–ê–ü–ê - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            gnome: { 
                name: "–ì–Ω–æ–º", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ì–ù–û–ú - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            goblin: { 
                name: "–ì–æ–±–ª–∏–Ω", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ì–û–ë–õ–ò–ù - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            dwarf: { 
                name: "–î–≤–∞—Ä—Ñ", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–î–í–ê–†–§ - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            dragonid: { 
                name: "–î—Ä–∞–∫–æ–Ω–∏–¥", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–î–†–ê–ö–û–ù–ò–î - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            ignis: { 
                name: "–ò–≥–Ω–∏—Å", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ò–ì–ù–ò–° - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            infernis: { 
                name: "–ò–Ω—Ñ–µ—Ä–Ω–∏—Å", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ò–ù–§–ï–†–ù–ò–° - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            katari: { 
                name: "–ö–∞—Ç–∞—Ä–∏", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ö–ê–¢–ê–†–ò - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            clank: { 
                name: "–ö–ª–∞–Ω–∫", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ö–õ–ê–ù–ö - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            orc: { 
                name: "–û—Ä–∫", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–û–†–ö - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            halfling: { 
                name: "–ü–æ–ª—É—Ä–æ—Å–ª–∏–∫", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ü–û–õ–£–†–û–°–õ–ò–ö - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            ribbet: { 
                name: "–†–∏–±–±–µ—Ç", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–†–ò–ë–ë–ï–¢ - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            simian: { 
                name: "–°–∏–º–∏–∞–Ω", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–°–ò–ú–ò–ê–ù - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            terran: { 
                name: "–¢–µ—Ä—Ä–∞–Ω", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–¢–ï–†–†–ê–ù - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            faun: { 
                name: "–§–∞–≤–Ω", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–§–ê–í–ù - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            fangril: { 
                name: "–§–∞–Ω–≥—Ä–∏–ª", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–§–ê–ù–ì–†–ò–õ - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            faerie: { 
                name: "–§–µ–π—Ä–∏", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–§–ï–ô–†–ò - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            firbolg: { 
                name: "–§–∏—Ä–±–æ–ª–≥", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–§–ò–†–ë–û–õ–ì - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            human: { 
                name: "–ß–µ–ª–æ–≤–µ–∫", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ß–ï–õ–û–í–ï–ö - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            elf: { 
                name: "–≠–ª—å—Ñ", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–≠–õ–¨–§ - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            },
            etheris: { 
                name: "–≠—Ñ–∏—Ä–∏—Å", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–≠–§–ò–†–ò–° - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart" 
            }
        };

        // –î–∞–Ω–Ω—ã–µ –æ –∫–ª–∞—Å—Å–∞—Ö
        var classData = {
            bard: { 
                name: "–ë–∞—Ä–¥", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ë–ê–†–î - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart",
                domains: ["codex", "grace"],
                stats: { agility: 0, strength: -1, finesse: +1, instinct: 0, presence: +2, knowledge: +1 },
                evasion: 10,
                hitPoints: 5
            },
            rogue: { 
                name: "–ü–ª—É—Ç", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ü–õ–£–¢ - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart",
                domains: ["grace", "midnight"], 
                stats: { strength: -1, agility: +1, finesse: +2, instinct: +1, presence: 0, knowledge: 0 },
                evasion: 12,
                hitPoints: 6
            },
            sorcerer: { 
                name: "–ß–∞—Ä–æ–¥–µ–π", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ß–ê–†–û–î–ï–ô - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart",
                domains: ["midnight", "arcana"], 
                stats: { strength: -1, agility: 0, finesse: +1, instinct: +2, presence: +1, knowledge: +0 },
                evasion: 10,
                hitPoints: 6
            },
            druid: { 
                name: "–î—Ä—É–∏–¥", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–î–†–£–ò–î - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart",
                domains: ["arcana", "sage"], 
                stats: { strength: 0, agility: +1, finesse: +1, instinct: +2, presence: -1, knowledge: 0 },
                evasion: 10,
                hitPoints: 6
            },
            ranger: { 
                name: "–°–ª–µ–¥–æ–ø—ã—Ç", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–°–õ–ï–î–û–ü–´–¢ - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart",
                domains: ["sage", "bone"], 
                stats: { strength: 0, agility: +2, finesse: +1, instinct: +1, presence: -1, knowledge: 0 },
                evasion: 12,
                hitPoints: 6
            },
            warrior: { 
                name: "–í–æ–∏–Ω", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–í–û–ò–ù - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart",
                domains: ["bone", "blade"], 
                stats: { strength: +1, agility: +2, finesse: 0, instinct: +1, presence: -1, knowledge: 0 },
                evasion: 11,
                hitPoints: 6
            },
            guardian: { 
                name: "–°—Ç—Ä–∞–∂", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–°–¢–†–ê–ñ - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart",
                domains: ["blade", "valor"], 
                stats: { strength: +2, agility: +1, finesse: -1, instinct: 0, presence: +1, knowledge: 0 },
                evasion: 9,
                hitPoints: 7
            },
            seraph: { 
                name: "–°–µ—Ä–∞—Ñ–∏–º", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–°–ï–†–ê–§–ò–ú - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart",
                domains: ["valor", "splendor"], 
                stats: { strength: +2, agility: 0, finesse: 0, instinct: +1, presence: +1, knowledge: -1 },
                evasion: 9,
                hitPoints: 7
            },
            wizard: { 
                name: "–í–æ–ª—à–µ–±–Ω–∏–∫", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–í–û–õ–®–ï–ë–ù–ò–ö - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart",
                domains: ["splendor", "codex"], 
                stats: { strength: 0, agility: -1, finesse: 0, instinct: +1, presence: +1, knowledge: +2 },
                evasion: 11,
                hitPoints: 5
            }
        };

        // –î–∞–Ω–Ω—ã–µ –æ–± —ç–∫–∏–ø–∏—Ä–æ–≤–∫–µ –ø–æ –∫–ª–∞—Å—Å–∞–º
        var equipmentData = {
            seraph: {
                armor: {
                    image: "images/armor/05-59-chainmail armor.png",
                    name: "–ö–æ–ª—å—á—É–∂–Ω–∞—è –±—Ä–æ–Ω—è",
                    defense: "+4 –ë—Ä–æ–Ω—è",
                    type: "–°—Ä–µ–¥–Ω—è—è",
                    trait: "-1 –£–∫–ª–æ–Ω–µ–Ω–∏–µ",
                    armorBonus: 4,
                    evasionBonus: -1
                },
                mainWeapon: {
                    image: "images/weapons/05-13-hallowed-axe.png",
                    name: "–°–≤—è—Ç–æ–π —Ç–æ–ø–æ—Ä",
                    damage: "d8+1 –º–∞–≥.",
                    type: "–û–¥–Ω–æ—Ä—É—á–Ω–æ–µ",
                    range: "–í–ø–ª–æ—Ç–Ω—É—é",
                    trait: "-"
                },
                offWeapon: {
                    image: "images/weapons/05-50-round shield.png",
                    name: "–ö—Ä—É–≥–ª—ã–π —â–∏—Ç",
                    damage: "d4 —Ñ–∏–∑.",
                    type: "–û–¥–Ω–æ—Ä—É—á–Ω–æ–µ", 
                    range: "–í–ø–ª–æ—Ç–Ω—É—é",
                    trait: "+1 –ë—Ä–æ–Ω—è",
                    armorBonus: 1
                }
            },
            wizard: {
                armor: {
                    image: "images/armor/05-58-leather armor.png",
                    name: "–ö–æ–∂–∞–Ω—ã–µ –¥–æ—Å–ø–µ—Ö–∏",
                    defense: "+3 –ë—Ä–æ–Ω—è",
                    type: "–õ–µ–≥–∫–∞—è",
                    trait: "-",
                    armorBonus: 3,
                    evasionBonus: 0
                },
                mainWeapon: {
                    image: "images/weapons/05-16-greatstaff.png",
                    name: "–í–µ–ª–∏–∫–∏–π –ø–æ—Å–æ—Ö",
                    damage: "d6 –º–∞–≥.",
                    type: "–î–≤—É—Ä—É—á–Ω–æ–µ",
                    range: "–î–∞–ª–µ–∫–æ",
                    trait: "–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∞—Ç–∞–∫–µ –±—Ä–æ—Å—å—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫—É–±–∏–∫ —É—Ä–æ–Ω–∞ –∏ –æ—Ç–±—Ä–æ—Å—å—Ç–µ –∫—É–±–∏–∫ —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º."
                },
                offWeapon: {
                    image: "images/weapons/05-16-greatstaff.png",
                    name: "–í–µ–ª–∏–∫–∏–π –ø–æ—Å–æ—Ö",
                    damage: "-",
                    type: "-",
                    range: "-",
                    trait: "-",
                    isSecondHand: true
                }
            },
            guardian: {
                armor: {
                    image: "images/armor/05-59-chainmail armor.png",
                    name: "–ö–æ–ª—å—á—É–∂–Ω–∞—è –±—Ä–æ–Ω—è",
                    defense: "+4 –ë—Ä–æ–Ω—è",
                    type: "–°—Ä–µ–¥–Ω—è—è",
                    trait: "-1 –£–∫–ª–æ–Ω–µ–Ω–∏–µ",
                    armorBonus: 4,
                    evasionBonus: -1
                },
                mainWeapon: {
                    image: "images/weapons/05-15-Battleaxe.png",
                    name: "–ë–æ–µ–≤–æ–π —Ç–æ–ø–æ—Ä",
                    damage: "d10+3 —Ñ–∏–∑.",
                    type: "–î–≤—É—Ä—É—á–Ω–æ–µ",
                    range: "–í–ø–ª–æ—Ç–Ω—É—é",
                    trait: "-"
                },
                offWeapon: {
                    image: "images/weapons/05-15-Battleaxe.png",
                    name: "–ë–æ–µ–≤–æ–π —Ç–æ–ø–æ—Ä",
                    damage: "-",
                    type: "-",
                    range: "-",
                    trait: "-",
                    isSecondHand: true
                }
            },
            warrior: {
                armor: {
                    image: "images/armor/05-59-chainmail armor.png",
                    name: "–ö–æ–ª—å—á—É–∂–Ω–∞—è –±—Ä–æ–Ω—è",
                    defense: "+4 –ë—Ä–æ–Ω—è",
                    type: "–°—Ä–µ–¥–Ω—è—è",
                    trait: "-1 –£–∫–ª–æ–Ω–µ–Ω–∏–µ",
                    armorBonus: 4,
                    evasionBonus: -1
                },
                mainWeapon: {
                    image: "images/weapons/05-05-longsword.png",
                    name: "–î–ª–∏–Ω–Ω—ã–π –º–µ—á",
                    damage: "d8+3 —Ñ–∏–∑.",
                    type: "–î–≤—É—Ä—É—á–Ω–æ–µ",
                    range: "–í–ø–ª–æ—Ç–Ω—É—é",
                    trait: "-"
                },
                offWeapon: {
                    image: "images/weapons/05-05-longsword.png",
                    name: "–î–ª–∏–Ω–Ω—ã–π –º–µ—á",
                    damage: "-",
                    type: "-",
                    range: "-",
                    trait: "-",
                    isSecondHand: true
                }
            },
            ranger: {
                armor: {
                    image: "images/armor/05-58-leather armor.png",
                    name: "–ö–æ–∂–∞–Ω—ã–µ –¥–æ—Å–ø–µ—Ö–∏",
                    defense: "+3 –ë—Ä–æ–Ω—è",
                    type: "–õ–µ–≥–∫–∞—è",
                    trait: "-",
                    armorBonus: 3,
                    evasionBonus: 0
                },
                mainWeapon: {
                    image: "images/weapons/05-17-longbow.png",
                    name: "–î–ª–∏–Ω–Ω—ã–π –ª—É–∫", 
                    damage: "d6+3 —Ñ–∏–∑.",
                    type: "–î–≤—É—Ä—É—á–Ω–æ–µ",
                    range: "–î–∞–ª–µ–∫–æ",
                    trait: "-"
                },
                offWeapon: {
                    image: "images/weapons/05-17-longbow.png",
                    name: "–î–ª–∏–Ω–Ω—ã–π –ª—É–∫", 
                    damage: "-",
                    type: "-",
                    range: "-",
                    trait: "-",
                    isSecondHand: true
                }
            },
            druid: {
                armor: {
                    image: "images/armor/05-58-leather armor.png",
                    name: "–ö–æ–∂–∞–Ω—ã–µ –¥–æ—Å–ø–µ—Ö–∏",
                    defense: "+3 –ë—Ä–æ–Ω—è",
                    type: "–õ–µ–≥–∫–∞—è",
                    trait: "-",
                    armorBonus: 3,
                    evasionBonus: 0
                },
                mainWeapon: {
                    image: "images/weapons/05-19-shortstaff.png",
                    name: "–ö–æ—Ä–æ—Ç–∫–∏–π –ø–æ—Å–æ—Ö",
                    damage: "d8+1 —Ñ–∏–∑.",
                    type: "–û–¥–Ω–æ—Ä—É—á–Ω–æ–µ",
                    range: "–ë–ª–∏–∑–∫–æ",
                    trait: "-"
                },
                offWeapon: {
                    image: "images/weapons/05-50-round shield.png",
                    name: "–ö—Ä—É–≥–ª—ã–π —â–∏—Ç",
                    damage: "d4 —Ñ–∏–∑.",
                    type: "–û–¥–Ω–æ—Ä—É—á–Ω–æ–µ",
                    range: "–í–ø–ª–æ—Ç–Ω—É—é",
                    trait: "+1 –ë—Ä–æ–Ω—è",
                    armorBonus: 1
                }
            },
            sorcerer: {
                armor: {
                    image: "images/armor/05-57-gambeson armor.png",
                    name: "–ì–∞–º–±–µ–∑–æ–Ω",
                    defense: "+3 –ë—Ä–æ–Ω—è",
                    type: "–õ–µ–≥–∫–∞—è",
                    trait: "+1 –£–∫–ª–æ–Ω–µ–Ω–∏–µ",
                    armorBonus: 3,
                    evasionBonus: 1 
                },
                mainWeapon: {
                    image: "images/weapons/05-18-dualstaff.png",
                    name: "–î—É–∞–ª—å–Ω—ã–π –ø–æ—Å–æ—Ö",
                    damage: "d6+3 –º–∞–≥.",
                    type: "–î–≤—É—Ä—É—á–Ω–æ–µ",
                    range: "–î–∞–ª–µ–∫–æ",
                    trait: "-"
                },
                offWeapon: {
                    image: "images/weapons/05-18-dualstaff.png",
                    name: "–î—É–∞–ª—å–Ω—ã–π –ø–æ—Å–æ—Ö",
                    damage: "-",
                    type: "-",
                    range: "-",
                    trait: "-",
                    isSecondHand: true
                }
            },
            rogue: {
                armor: {
                    image: "images/armor/05-57-gambeson armor.png",
                    name: "–ì–∞–º–±–µ–∑–æ–Ω",
                    defense: "+3 –ë—Ä–æ–Ω—è",
                    type: "–õ–µ–≥–∫–∞—è",
                    trait: "+1 –£–∫–ª–æ–Ω–µ–Ω–∏–µ",
                    armorBonus: 3,
                    evasionPenalty: 0,
                    evasionBonus: 1
                },
                mainWeapon: {
                    image: "images/weapons/05-09-dagger.png",
                    name: "–ö–∏–Ω–∂–∞–ª",
                    damage: "d8+1 —Ñ–∏–∑.",
                    type: "–û–¥–Ω–æ—Ä—É—á–Ω–æ–µ",
                    range: "–í–ø–ª–æ—Ç–Ω—É—é",
                    trait: "-"
                },
                offWeapon: {
                    image: "images/weapons/05-45-small dagger.png",
                    name: "–ú–∞–ª—ã–π –∫–∏–Ω–∂–∞–ª",
                    damage: "+2 —Ñ–∏–∑.",
                    type: "–û–¥–Ω–æ—Ä—É—á–Ω–æ–µ",
                    range: "–í–ø–ª–æ—Ç–Ω—É—é",
                    trait: "-"
                }
            },
            bard: {
                armor: {
                    image: "images/armor/05-57-gambeson armor.png",
                    name: "–ì–∞–º–±–µ–∑–æ–Ω",
                    defense: "+3 –ë—Ä–æ–Ω—è",
                    type: "–õ–µ–≥–∫–∞—è",
                    trait: "+1 –£–∫–ª–æ–Ω–µ–Ω–∏–µ",
                    armorBonus: 3,
                    evasionBonus: 1
                },
                mainWeapon: {
                    image: "images/weapons/05-03-rapier.png",
                    name: "–†–∞–ø–∏—Ä–∞",
                    damage: "d8 —Ñ–∏–∑.",
                    type: "–û–¥–Ω–æ—Ä—É—á–Ω–æ–µ",
                    range: "–í–ø–ª–æ—Ç–Ω—É—é",
                    trait: "–ö–æ–≥–¥–∞ –≤—ã —Å–æ–≤–µ—Ä—à–∞–µ—Ç–µ –∞—Ç–∞–∫—É, –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ç–º–µ—Ç–∏—Ç—å –î—Ä–∞–º—É, —á—Ç–æ–±—ã –ø–æ—Ä–∞–∑–∏—Ç—å –µ—â–µ –æ–¥–Ω–æ —Å—É—â–µ—Å—Ç–≤–æ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–æ—Å—è–≥–∞–µ–º–æ—Å—Ç–∏."
                },
                offWeapon: {
                    image: "images/weapons/05-45-small dagger.png",
                    name: "–ú–∞–ª—ã–π –∫–∏–Ω–∂–∞–ª",
                    damage: "+2 —Ñ–∏–∑.",
                    type: "–û–¥–Ω–æ—Ä—É—á–Ω–æ–µ",
                    range: "–í–ø–ª–æ—Ç–Ω—É—é",
                    trait: "-"
                }
            }
};

        // –î–∞–Ω–Ω—ã–µ –æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è—Ö
        var backgroundData = {
            noble: { 
                name: "–í–µ–ª–∏–∫–æ—Ä–æ–¥–Ω–æ–µ", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–í–ï–õ–ò–ö–û–†–û–î–ù–û–ï - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart. –ü–µ—Ä—Å–æ–Ω–∞–∂ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑ –∑–Ω–∞—Ç–Ω–æ–π —Å–µ–º—å–∏." 
            },
            military: { 
                name: "–í–æ–µ–Ω–Ω–æ–µ", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–í–û–ï–ù–ù–û–ï - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart. –ü–µ—Ä—Å–æ–Ω–∞–∂ –∏–º–µ–µ—Ç –≤–æ–µ–Ω–Ω–æ–µ –ø—Ä–æ—à–ª–æ–µ." 
            },
            mountain: { 
                name: "–ì–æ—Ä–Ω–æ–µ", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ì–û–†–ù–û–ï - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart. –ü–µ—Ä—Å–æ–Ω–∞–∂ –≤—ã—Ä–æ—Å –≤ –≥–æ—Ä–∞—Ö." 
            },
            dogmatic: { 
                name: "–î–æ–≥–º–∞—Ç–∏—á–Ω–æ–µ", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–î–û–ì–ú–ê–¢–ò–ß–ù–û–ï - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart. –ü–µ—Ä—Å–æ–Ω–∞–∂ —Å–ª–µ–¥—É–µ—Ç —Å—Ç—Ä–æ–≥–∏–º —É–±–µ–∂–¥–µ–Ω–∏—è–º." 
            },
            lost: { 
                name: "–ó–∞–±–ª—É–¥—à–µ–µ", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ó–ê–ë–õ–£–î–®–ï–ï - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart. –ü–µ—Ä—Å–æ–Ω–∞–∂ –ø–æ—Ç–µ—Ä—è–ª —Å–≤–æ–π –ø—É—Ç—å." 
            },
            nomadic: { 
                name: "–ö–æ—á–µ–≤–æ–µ", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ö–û–ß–ï–í–û–ï - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart. –ü–µ—Ä—Å–æ–Ω–∞–∂ –≤—Å–µ–≥–¥–∞ –≤ –¥–≤–∏–∂–µ–Ω–∏–∏." 
            },
            criminal: { 
                name: "–ö—Ä–∏–º–∏–Ω–∞–ª—å–Ω–æ–µ", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ö–†–ò–ú–ò–ù–ê–õ–¨–ù–û–ï - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart. –ü–µ—Ä—Å–æ–Ω–∞–∂ —Å–≤—è–∑–∞–Ω —Å –ø—Ä–µ—Å—Ç—É–ø–Ω—ã–º –º–∏—Ä–æ–º." 
            },
            forest: { 
                name: "–õ–µ—Å–Ω–æ–µ", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–õ–ï–°–ù–û–ï - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart. –ü–µ—Ä—Å–æ–Ω–∞–∂ –≤—ã—Ä–æ—Å —Å—Ä–µ–¥–∏ –¥–µ—Ä–µ–≤—å–µ–≤." 
            },
            frost: { 
                name: "–ú–æ—Ä–æ–∑–Ω–æ–µ", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ú–û–†–û–ó–ù–û–ï - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart. –ü–µ—Ä—Å–æ–Ω–∞–∂ –∑–∞–∫–∞–ª–µ–Ω —Ö–æ–ª–æ–¥–æ–º." 
            },
            sea: { 
                name: "–ú–æ—Ä—Å–∫–æ–µ", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ú–û–†–°–ö–û–ï - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart. –ü–µ—Ä—Å–æ–Ω–∞–∂ —Å–≤—è–∑–∞–Ω —Å –º–æ—Ä–µ–º." 
            },
            scientific: { 
                name: "–ù–∞—É—á–Ω–æ–µ", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ù–ê–£–ß–ù–û–ï - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart. –ü–µ—Ä—Å–æ–Ω–∞–∂ —Å—Ç—Ä–µ–º–∏—Ç—Å—è –∫ –∑–Ω–∞–Ω–∏—è–º." 
            },
            liberated: { 
                name: "–û—Å–≤–æ–±–æ–∂–¥—ë–Ω–Ω–æ–µ", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–û–°–í–û–ë–û–ñ–î–Å–ù–ù–û–ï - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart. –ü–µ—Ä—Å–æ–Ω–∞–∂ –æ–±—Ä–µ–ª —Å–≤–æ–±–æ–¥—É." 
            },
            underground: { 
                name: "–ü–æ–¥–∑–µ–º–Ω–æ–µ", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ü–û–î–ó–ï–ú–ù–û–ï - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart. –ü–µ—Ä—Å–æ–Ω–∞–∂ –≤—ã—Ä–æ—Å –ø–æ–¥ –∑–µ–º–ª–µ–π." 
            },
            desert: { 
                name: "–ü—É—Å—Ç—ã–Ω–Ω–æ–µ", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–ü–£–°–¢–´–ù–ù–û–ï - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart. –ü–µ—Ä—Å–æ–Ω–∞–∂ –∑–∞–∫–∞–ª–µ–Ω –ø—É—Å—Ç—ã–Ω–µ–π." 
            },
            rural: { 
                name: "–°–µ–ª—å—Å–∫–æ–µ", 
                description: "–ó–ê–ì–õ–£–®–ö–ê_–û–ü–ò–°–ê–ù–ò–ï_–°–ï–õ–¨–°–ö–û–ï - –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑ –ø—Ä–∞–≤–∏–ª Daggerheart. –ü–µ—Ä—Å–æ–Ω–∞–∂ –≤—ã—Ä–æ—Å –≤ –¥–µ—Ä–µ–≤–Ω–µ." 
            }
        };

        // –î–∞–Ω–Ω—ã–µ –æ –¥–æ–º–µ–Ω–∞—Ö
        var domainData = {
            codex:    { name: "–ö–æ–¥–µ–∫—Å",    icon: "images/domaines/codex.svg" },
            grace:    { name: "–ì—Ä–∞—Ü–∏—è",    icon: "images/domaines/grace.svg" },
            midnight: { name: "–ü–æ–ª–Ω–æ—á—å",   icon: "images/domaines/midnight.svg" },
            arcana:   { name: "–ê—Ä–∫–∞–Ω–∞",    icon: "images/domaines/arcana.svg" },
            sage:     { name: "–ú—É–¥—Ä–æ—Å—Ç—å",  icon: "images/domaines/sage.svg" },
            bone:     { name: "–ö–æ—Å—Ç—å",     icon: "images/domaines/bone.svg" },
            blade:    { name: "–ö–ª–∏–Ω–æ–∫",    icon: "images/domaines/blade.svg" },
            valor:    { name: "–î–æ–±–ª–µ—Å—Ç—å",  icon: "images/domaines/valor.svg" },
            splendor: { name: "–í–µ–ª–∏—á–∏–µ",   icon: "images/domaines/splendor.svg" }
        };
        
        var rulesFromScreen = 'main-menu';

        // –§—É–Ω–∫—Ü–∏–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function showMainMenu() {
            hideAllScreens();
            document.getElementById('main-menu').classList.remove('hidden');
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –µ—Å–ª–∏ –µ—Å—Ç—å
            if (typeof(Storage) !== "undefined") {
                var savedCharacter = localStorage.getItem('daggerheart_character');
                if (savedCharacter) {
                    currentCharacter = JSON.parse(savedCharacter);
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ –∏–≥—Ä—ã
            updateMenuButtons();
        }

        function showCharacterCreation() {
            hideAllScreens();
            document.getElementById('character-creation').classList.remove('hidden');
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            makeFieldsEditable();
            
            // –°–±—Ä–æ—Å –≤—Å–µ—Ö –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã
            document.getElementById('char-name').value = '';
            document.getElementById('char-ancestry').value = '';
            document.getElementById('char-background').value = '';
            document.getElementById('char-class').value = '';
            
            // –°–±—Ä–æ—Å —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–æ–∫ –≥–µ–Ω–¥–µ—Ä–∞ –Ω–∞ –º—É–∂—Å–∫–æ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            var genderRadios = document.getElementsByName('gender');
            for (var i = 0; i < genderRadios.length; i++) {
                if (genderRadios[i].value === 'male') {
                    genderRadios[i].checked = true;
                } else {
                    genderRadios[i].checked = false;
                }
            }
            
            // –°–±—Ä–æ—Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –Ω–∞ 0
            document.getElementById('strength').value = 0;
            document.getElementById('agility').value = 0;
            document.getElementById('finesse').value = 0;
            document.getElementById('instinct').value = 0;
            document.getElementById('presence').value = 0;
            document.getElementById('knowledge').value = 0;
            
            // –°–±—Ä–æ—Å –∑–∞—â–∏—Ç—ã
            document.getElementById('evasion').textContent = 0;
            document.getElementById('armor').textContent = 0;
            
            // –°–±—Ä–æ—Å –¥–æ–º–µ–Ω–æ–≤ –Ω–∞ –∑–∞–≥–ª—É—à–∫–∏
            var domain1Slot = document.getElementById('domain-1');
            var domain2Slot = document.getElementById('domain-2');
            domain1Slot.querySelector('.domain-icon').src = "images/domaines/domain-placeholder.svg";
            domain1Slot.querySelector('.domain-name').textContent = "-";
            domain2Slot.querySelector('.domain-icon').src = "images/domaines/domain-placeholder.svg";
            domain2Slot.querySelector('.domain-name').textContent = "-";
            
            // –°–±—Ä–æ—Å –ø–æ—Ä—Ç—Ä–µ—Ç–∞ –Ω–∞ –∑–∞–≥–ª—É—à–∫—É
            document.getElementById('char-portrait').src = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTEwIiBoZWlnaHQ9IjExMCIgdmlld0JveD0iMCAwIDExMCAxMTAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMTEiIGhlaWdodD0iMTEwIiByeD0iNTUiIGZpbGw9IiNGNUY1RjUiLz4KPHN2ZyB4PSIzMCIgeT0iMjUiIHdpZHRoPSI1MCIgaGVpZ2h0PSI2MCI+CiAgPGNpcmNsZSBjeD0iMjUiIGN5PSIyMCIgcj0iMTIiIGZpbGw9IiNERCQiLz4KICA8ZWxsaXBzZSBjeD0iMjUiIGN5PSI0NSIgcng9IjE4IiByeT0iMjAiIGZpbGw9IiNERCQiLz4KPC9zdmc+Cjwvc3ZnPg==";

            // –°–±—Ä–æ—Å —Ç—Ä–µ–∫–æ–≤
            updateLifeTrack(0);
            updateDramaTrack(0);
            updateHopeTrack(2); // –ë–∞–∑–æ–≤–∞—è –Ω–∞–¥–µ–∂–¥–∞
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è
            restoreCreationButtons();
        }

        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        function restoreCreationButtons() {
            var buttonContainer = document.querySelector('#character-creation .card');
            var existingButtons = buttonContainer.querySelectorAll('.button');
            
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–Ω–æ–ø–∫–∏
            for (var i = existingButtons.length - 1; i >= 0; i--) {
                existingButtons[i].remove();
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            var saveButton = document.createElement('button');
            saveButton.className = 'button';
            saveButton.onclick = saveCharacter;
            saveButton.innerHTML = '‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞';
            
            var backButton = document.createElement('button');
            backButton.className = 'button secondary';
            backButton.onclick = showMainMenu;
            backButton.innerHTML = '‚Üê –ù–∞–∑–∞–¥';
            
            buttonContainer.appendChild(saveButton);
            buttonContainer.appendChild(backButton);
        }

        function showDiceRoll() {
            hideAllScreens();
            document.getElementById('dice-roll').classList.remove('hidden');
        }

        function showSession() {
            hideAllScreens();
            document.getElementById('session-state').classList.remove('hidden');
            loadSessionData();
        }

        function showRules() {
            rulesFromScreen = getCurrentScreen();
            hideAllScreens();
            document.getElementById('rules').classList.remove('hidden');
            showRulesMain();
        }

        function showRulesMain() {
            hideAllRulesSections();
            document.getElementById('rules-main').classList.remove('hidden');
            document.getElementById('rules-breadcrumb').textContent = '–ü—Ä–∞–≤–∏–ª–∞';
        }

        function showRulesSection(section) {
            hideAllRulesSections();
            document.getElementById('rules-' + section).classList.remove('hidden');
            
            var sectionNames = {
                'distances': '–ü—Ä–∞–≤–∏–ª–∞ > –î–∏—Å—Ç–∞–Ω—Ü–∏–∏',
                'combat': '–ü—Ä–∞–≤–∏–ª–∞ > –ë–æ–π', 
                'glossary': '–ü—Ä–∞–≤–∏–ª–∞ > –ì–ª–æ—Å—Å–∞—Ä–∏–π'
            };
            document.getElementById('rules-breadcrumb').textContent = sectionNames[section] || '–ü—Ä–∞–≤–∏–ª–∞';
        }

        function hideAllRulesSections() {
            var sections = ['rules-main', 'rules-distances', 'rules-combat', 'rules-glossary'];
            for (var i = 0; i < sections.length; i++) {
                document.getElementById(sections[i]).classList.add('hidden');
            }
        }

        function openRulesLink(section, anchor) {
            rulesFromScreen = getCurrentScreen();
            hideAllScreens();
            document.getElementById('rules').classList.remove('hidden');
            showRulesSection(section);
        }

        function goBackFromRules() {
            hideAllScreens();
            if (rulesFromScreen === 'character-creation') {
                document.getElementById('character-creation').classList.remove('hidden');
            } else if (rulesFromScreen === 'dice-roll') {
                document.getElementById('dice-roll').classList.remove('hidden');
            } else if (rulesFromScreen === 'session-state') {
                document.getElementById('session-state').classList.remove('hidden');
                loadSessionData();
            } else {
                document.getElementById('main-menu').classList.remove('hidden');
            }
        }

        function getCurrentScreen() {
            var screens = ['main-menu', 'character-creation', 'dice-roll', 'session-state'];
            for (var i = 0; i < screens.length; i++) {
                if (!document.getElementById(screens[i]).classList.contains('hidden')) {
                    return screens[i];
                }
            }
            return 'main-menu';
        }

        function hideAllScreens() {
            var screens = ['main-menu', 'character-creation', 'dice-roll', 'session-state', 'rules', 'inventory'];
            for (var i = 0; i < screens.length; i++) {
                document.getElementById(screens[i]).classList.add('hidden');
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        function updatePortrait() {
            var ancestry = document.getElementById('char-ancestry').value;
            var genderRadios = document.getElementsByName('gender');
            var gender = 'male';

            for (var i = 0; i < genderRadios.length; i++) {
                if (genderRadios[i].checked) {
                    gender = genderRadios[i].value;
                    break;
                }
            }

            var portraitImg = document.getElementById('char-portrait');

            if (!ancestry || ancestry === "") {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Ä—Ç—Ä–µ—Ç-–∑–∞–≥–ª—É—à–∫—É
                portraitImg.src = "images/portraits/placeholder.png";
            } else if (ancestry && portraitImg) {
                var portraitPath = './images/portraits/' + ancestry + '_' + gender + '.png';
                portraitImg.src = portraitPath;
            }
        }

        function updateDomains() {
            var classValue = document.getElementById('char-class').value;
            var domain1Slot = document.getElementById('domain-1');
            var domain2Slot = document.getElementById('domain-2');

            if (classValue && classData[classValue]) {
                var domains = classData[classValue].domains;
                var stats = classData[classValue].stats;
                var baseEvasion = classData[classValue].evasion;
                var hitPoints = classData[classValue].hitPoints;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ–º–µ–Ω—ã
                var domain1Data = domainData[domains[0]];
                if (domain1Data) {
                    domain1Slot.querySelector('.domain-icon').src = domain1Data.icon;
                    domain1Slot.querySelector('.domain-name').textContent = domain1Data.name;
                }

                var domain2Data = domainData[domains[1]];
                if (domain2Data) {
                    domain2Slot.querySelector('.domain-icon').src = domain2Data.icon;
                    domain2Slot.querySelector('.domain-name').textContent = domain2Data.name;
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
                if (stats) {
                    document.getElementById('strength').value = stats.strength;
                    document.getElementById('agility').value = stats.agility;
                    document.getElementById('finesse').value = stats.finesse;
                    document.getElementById('instinct').value = stats.instinct;
                    document.getElementById('presence').value = stats.presence;
                    document.getElementById('knowledge').value = stats.knowledge;
                }

                // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é –±—Ä–æ–Ω—é –∏ —É–∫–ª–æ–Ω–µ–Ω–∏–µ —Å —É—á–µ—Ç–æ–º —ç–∫–∏–ø–∏—Ä–æ–≤–∫–∏
                var finalArmor = 0; // –ë–∞–∑–æ–≤–∞—è –±—Ä–æ–Ω—è
                var finalEvasion = baseEvasion;
                
                var classEquipment = equipmentData[classValue];
                if (classEquipment) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –±–æ–Ω—É—Å—ã –æ—Ç –±—Ä–æ–Ω–∏
                    if (classEquipment.armor && classEquipment.armor.armorBonus) {
                        finalArmor += classEquipment.armor.armorBonus;
                    }
                    if (classEquipment.armor && classEquipment.armor.evasionBonus) {
                        finalEvasion += classEquipment.armor.evasionBonus;
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –±–æ–Ω—É—Å—ã –æ—Ç –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–≥–æ –æ—Ä—É–∂–∏—è (—â–∏—Ç–∞)
                    if (classEquipment.offWeapon && classEquipment.offWeapon.armorBonus) {
                        finalArmor += classEquipment.offWeapon.armorBonus;
                    }
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                document.getElementById('evasion').textContent = finalEvasion;
                document.getElementById('armor').textContent = finalArmor;

                // –û–±–Ω–æ–≤–ª—è–µ–º –∫—É–±–∏–∫–∏ –∂–∏–∑–Ω–∏
                if (hitPoints !== undefined) {
                    updateLifeTrack(hitPoints);
                }
            } else {
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                domain1Slot.querySelector('.domain-icon').src = "images/domaines/domain-placeholder.svg";
                domain1Slot.querySelector('.domain-name').textContent = "-";
                domain2Slot.querySelector('.domain-icon').src = "images/domaines/domain-placeholder.svg";
                domain2Slot.querySelector('.domain-name').textContent = "-";

                document.getElementById('strength').value = 0;
                document.getElementById('agility').value = 0;
                document.getElementById('finesse').value = 0;
                document.getElementById('instinct').value = 0;
                document.getElementById('presence').value = 0;
                document.getElementById('knowledge').value = 0;

                document.getElementById('evasion').textContent = 0;
                document.getElementById('armor').textContent = 0;
                updateLifeTrack(0);
            }
        }

        function saveCharacter() {
            var name = document.getElementById('char-name').value;
            var ancestry = document.getElementById('char-ancestry').value;
            var background = document.getElementById('char-background').value;
            var charClass = document.getElementById('char-class').value;

            if (!name || !ancestry || !charClass) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è!');
                return;
            }

            var genderRadios = document.getElementsByName('gender');
            var gender = 'male';
            for (var i = 0; i < genderRadios.length; i++) {
                if (genderRadios[i].checked) {
                    gender = genderRadios[i].value;
                    break;
                }
            }

            var stats = {
                strength: parseInt(document.getElementById('strength').value),
                agility: parseInt(document.getElementById('agility').value),
                finesse: parseInt(document.getElementById('finesse').value),
                instinct: parseInt(document.getElementById('instinct').value),
                presence: parseInt(document.getElementById('presence').value),
                knowledge: parseInt(document.getElementById('knowledge').value)
            };

            var classInfo = classData[charClass];
            var domains = classInfo ? classInfo.domains : [];

            // –ü–æ–ª—É—á–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –±—Ä–æ–Ω–∏ –∏ —É–∫–ª–æ–Ω–µ–Ω–∏—è (—É–∂–µ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–µ)
            var finalEvasion = parseInt(document.getElementById('evasion').textContent);
            var finalArmor = parseInt(document.getElementById('armor').textContent);

            currentCharacter = {
                name: name,
                ancestry: ancestry,
                background: background,
                gender: gender,
                class: charClass,
                stats: stats,
                domains: domains,
                evasion: finalEvasion, // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                armor: finalArmor,     // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                hitPoints: classInfo ? classInfo.hitPoints : 5,
                maxHitPoints: classInfo ? classInfo.hitPoints : 5,
                hopeTrack: 2,
                dramaTrack: 0
            };

            if (typeof(Storage) !== "undefined") {
                localStorage.setItem('daggerheart_character', JSON.stringify(currentCharacter));
            }

            alert('–ü–µ—Ä—Å–æ–Ω–∞–∂ —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!');
            showMainMenu();
            updateMenuButtons(); 
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É–±–æ–≤ –∂–∏–∑–Ω–∏
        function updateLifeTrack(filledCount) {
            var lifeTrack = document.getElementById('life-track');
            var boxes = lifeTrack.querySelectorAll('.track-box');
            
            for (var i = 0; i < boxes.length; i++) {
                if (i < filledCount) {
                    boxes[i].classList.remove('empty');
                    boxes[i].classList.add('filled');
                } else {
                    boxes[i].classList.remove('filled');
                    boxes[i].classList.add('empty');
                }
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É–±–æ–≤ –¥—Ä–∞–º—ã
        function updateDramaTrack(filledCount) {
            var dramaTrack = document.getElementById('drama-track');
            var boxes = dramaTrack.querySelectorAll('.track-box');
            
            for (var i = 0; i < boxes.length; i++) {
                if (i < filledCount) {
                    boxes[i].classList.remove('empty');
                    boxes[i].classList.add('filled');
                } else {
                    boxes[i].classList.remove('filled');
                    boxes[i].classList.add('empty');
                }
            }
        }
        
        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        function showClassInfo() {
            var classValue = document.getElementById('char-class').value;
            var modal = document.getElementById('class-modal');
            var title = document.getElementById('modal-class-title');
            var description = document.getElementById('modal-class-description');

            if (classValue && classData[classValue]) {
                title.textContent = classData[classValue].name;
                if (classData[classValue].description.includes('<')) {
                    description.innerHTML = classData[classValue].description;
                } else {
                    description.textContent = classData[classValue].description;
                }
            } else {
                title.textContent = "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∞—Å—Å–µ";
                description.textContent = "–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∞—Å—Å –∏–∑ —Å–ø–∏—Å–∫–∞.";
            }

            modal.style.display = 'block';
        }

        function closeClassModal() {
            document.getElementById('class-modal').style.display = 'none';
        }

        function showAncestryInfo() {
            var ancestry = document.getElementById('char-ancestry').value;
            var modal = document.getElementById('ancestry-modal');
            var title = document.getElementById('modal-ancestry-title');
            var description = document.getElementById('modal-ancestry-description');

            if (ancestry && ancestryData[ancestry]) {
                title.textContent = ancestryData[ancestry].name;
                if (ancestryData[ancestry].description.includes('<')) {
                    description.innerHTML = ancestryData[ancestry].description;
                } else {
                    description.textContent = ancestryData[ancestry].description;
                }
            } else {
                title.textContent = "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–æ–¥–æ—Å–ª–æ–≤–Ω–æ–π";
                description.textContent = "–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–¥–æ—Å–ª–æ–≤–Ω—É—é –∏–∑ —Å–ø–∏—Å–∫–∞.";
            }

            modal.style.display = 'block';
        }

        function closeAncestryModal() {
            document.getElementById('ancestry-modal').style.display = 'none';
        }

        function showBackgroundInfo() {
            var backgroundValue = document.getElementById('char-background').value;
            var modal = document.getElementById('background-modal');
            var title = document.getElementById('modal-background-title');
            var description = document.getElementById('modal-background-description');

            if (backgroundValue && backgroundData[backgroundValue]) {
                title.textContent = backgroundData[backgroundValue].name;
                if (backgroundData[backgroundValue].description.includes('<')) {
                    description.innerHTML = backgroundData[backgroundValue].description;
                } else {
                    description.textContent = backgroundData[backgroundValue].description;
                }
            } else {
                title.textContent = "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–∏";
                description.textContent = "–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –∏–∑ —Å–ø–∏—Å–∫–∞.";
            }

            modal.style.display = 'block';
        }

        function closeBackgroundModal() {
            document.getElementById('background-modal').style.display = 'none';
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function loadInventoryItems() {
            
            if (!currentCharacter || !currentCharacter.class) {
                clearInventoryDisplay();
                return;
            }

            var classEquipment = equipmentData[currentCharacter.class];
            if (!classEquipment) {
                clearInventoryDisplay();
                return;
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –±—Ä–æ–Ω—é
            if (classEquipment.armor) {
                document.getElementById('armor-image').src = classEquipment.armor.image;
                document.getElementById('armor-name').textContent = classEquipment.armor.name;
                document.getElementById('armor-defense').textContent = classEquipment.armor.defense;
                document.getElementById('armor-type').textContent = classEquipment.armor.type;
                document.getElementById('armor-trait').textContent = classEquipment.armor.trait;
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ –æ—Ä—É–∂–∏–µ
            if (classEquipment.mainWeapon) {
                console.log('Loading main weapon:', classEquipment.mainWeapon);
                document.getElementById('main-weapon-image').src = classEquipment.mainWeapon.image;
                document.getElementById('main-weapon-name').textContent = classEquipment.mainWeapon.name;
                document.getElementById('main-weapon-damage').textContent = classEquipment.mainWeapon.damage;
                document.getElementById('main-weapon-type').textContent = classEquipment.mainWeapon.type;
                document.getElementById('main-weapon-range').textContent = classEquipment.mainWeapon.range;
                document.getElementById('main-weapon-trait').textContent = classEquipment.mainWeapon.trait;
            }

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–µ –æ—Ä—É–∂–∏–µ
            if (classEquipment.offWeapon) {
                console.log('Loading off weapon:', classEquipment.offWeapon);
                var offWeaponImg = document.getElementById('off-weapon-image');
                offWeaponImg.src = classEquipment.offWeapon.image;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∑–∞—Ç–µ–º–Ω–µ–Ω–∏—è, –µ—Å–ª–∏ —ç—Ç–æ –≤—Ç–æ—Ä–∞—è —Ä—É–∫–∞ –¥–≤—É—Ä—É—á–Ω–æ–≥–æ –æ—Ä—É–∂–∏—è
                if (classEquipment.offWeapon.isSecondHand) {
                    offWeaponImg.classList.add('second-hand');
                } else {
                    offWeaponImg.classList.remove('second-hand');
                }
                
                document.getElementById('off-weapon-name').textContent = classEquipment.offWeapon.name;
                document.getElementById('off-weapon-damage').textContent = classEquipment.offWeapon.damage;
                document.getElementById('off-weapon-type').textContent = classEquipment.offWeapon.type;
                document.getElementById('off-weapon-range').textContent = classEquipment.offWeapon.range;
                document.getElementById('off-weapon-trait').textContent = classEquipment.offWeapon.trait;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function clearInventoryDisplay() {
            // –û—á–∏—â–∞–µ–º –±—Ä–æ–Ω—é
            document.getElementById('armor-image').src = "";
            document.getElementById('armor-name').textContent = "–ù–µ—Ç –±—Ä–æ–Ω–∏";
            document.getElementById('armor-defense').textContent = "-";
            document.getElementById('armor-type').textContent = "-";
            document.getElementById('armor-trait').textContent = "-";

            // –û—á–∏—â–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ –æ—Ä—É–∂–∏–µ
            document.getElementById('main-weapon-image').src = "";
            document.getElementById('main-weapon-name').textContent = "–ù–µ—Ç –æ—Ä—É–∂–∏—è";
            document.getElementById('main-weapon-damage').textContent = "-";
            document.getElementById('main-weapon-type').textContent = "-";
            document.getElementById('main-weapon-range').textContent = "-";
            document.getElementById('main-weapon-trait').textContent = "-";

            // –û—á–∏—â–∞–µ–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–µ –æ—Ä—É–∂–∏–µ
            document.getElementById('off-weapon-image').src = "";
            document.getElementById('off-weapon-name').textContent = "–ù–µ—Ç –æ—Ä—É–∂–∏—è";
            document.getElementById('off-weapon-damage').textContent = "-";
            document.getElementById('off-weapon-type').textContent = "-";
            document.getElementById('off-weapon-range').textContent = "-";
            document.getElementById('off-weapon-trait').textContent = "-";
        }        

    // –°–∏—Å—Ç–µ–º–∞ –º–æ–¥–∞–ª—å–Ω—ã—Ö –ø–æ–Ω—á–∏–∫–æ–≤
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞—Ö
        function showStatsMessage() {
            var classValue = document.getElementById('char-class').value;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω –∫–ª–∞—Å—Å
            if (classValue && classData[classValue]) {
                document.getElementById('stats-notification-modal').style.display = 'block';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã—Ç–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function closeStatsNotification() {
            document.getElementById('stats-notification-modal').style.display = 'none';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –æ–∫–Ω–∞
        window.onclick = function(event) {
            var modal = document.getElementById('stats-notification-modal');
            if (event.target == modal) {
                closeStatsNotification();
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
            var ancestryModal = document.getElementById('ancestry-modal');
            if (event.target == ancestryModal) {
                closeAncestryModal();
            }
            
            var classModal = document.getElementById('class-modal');
            if (event.target == classModal) {
                closeClassModal();
            }
            
            var backgroundModal = document.getElementById('background-modal');
            if (event.target == backgroundModal) {
                closeBackgroundModal();
            }
        }

        // –°–∏—Å—Ç–µ–º–∞ –±—Ä–æ—Å–∫–æ–≤ –∫—É–±–∏–∫–æ–≤
        function rollDice() {
            var rollButton = document.getElementById('roll-button');
            var hopeDice = document.getElementById('hope-dice');
            var fearDice = document.getElementById('fear-dice');
            var resultDiv = document.getElementById('roll-result');

            rollButton.disabled = true;
            hopeDice.classList.add('rolling');
            fearDice.classList.add('rolling');

            var rollCount = 0;
            var rollInterval = setInterval(function() {
                hopeDice.textContent = Math.floor(Math.random() * 12) + 1;
                fearDice.textContent = Math.floor(Math.random() * 12) + 1;
                rollCount++;

                if (rollCount >= 10) {
                    clearInterval(rollInterval);
                    finishRoll();
                }
            }, 50);
        }

        function finishRoll() {
            var hopeDice = document.getElementById('hope-dice');
            var fearDice = document.getElementById('fear-dice');
            var resultDiv = document.getElementById('roll-result');
            var rollButton = document.getElementById('roll-button');

            var hopeRoll = Math.floor(Math.random() * 12) + 1;
            var fearRoll = Math.floor(Math.random() * 12) + 1;

            hopeDice.textContent = hopeRoll;
            fearDice.textContent = fearRoll;

            hopeDice.classList.remove('rolling');
            fearDice.classList.remove('rolling');

            var difficulty = parseInt(document.getElementById('difficulty').value);
            var traitMod = getTraitModifier();
            var total = Math.max(hopeRoll, fearRoll) + traitMod;

            var resultText = '';
            var resultClass = '';

            if (hopeRoll === fearRoll) {
                resultText = 'üåü –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –£–°–ü–ï–•! (' + hopeRoll + '/' + fearRoll + ' + ' + traitMod + ' = ' + total + ')';
                resultClass = 'critical';
            } else if (total >= difficulty) {
                if (hopeRoll > fearRoll) {
                    resultText = '‚úÖ –£—Å–ø–µ—Ö —Å –ù–∞–¥–µ–∂–¥–æ–π! (' + total + ' ‚â• ' + difficulty + ')';
                    resultClass = 'success';
                } else {
                    resultText = '‚úÖ –£—Å–ø–µ—Ö —Å–æ –°—Ç—Ä–∞—Ö–æ–º (' + total + ' ‚â• ' + difficulty + ')';
                    resultClass = 'success';
                }
            } else {
                resultText = '‚ùå –ù–µ—É–¥–∞—á–∞ (' + total + ' < ' + difficulty + ')';
                resultClass = 'failure';
            }

            resultDiv.innerHTML = resultText;
            resultDiv.className = 'roll-result ' + resultClass;
            resultDiv.classList.remove('hidden');

            rollButton.disabled = false;
        }

        function getTraitModifier() {
            var traitSelect = document.getElementById('trait-modifier');
            var selectedTrait = traitSelect.value;

            if (selectedTrait === '0') {
                return 0;
            }

            return Math.floor(Math.random() * 6) - 2;
        }

        // –§—É–Ω–∫—Ü–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Å—Å–∏–∏
        function loadSessionData() {
            if (typeof(Storage) !== "undefined") {
                var savedCharacter = localStorage.getItem('daggerheart_character');
                if (savedCharacter) {
                    currentCharacter = JSON.parse(savedCharacter);
                }
            }
            updateSessionDisplay();
        }

        function updateSessionDisplay() {

            var characterInfo = document.getElementById('character-info');
            var inventoryInfo = document.getElementById('inventory-info');

            if (currentCharacter) {
                characterInfo.innerHTML = 
                    '<button class="button" onclick="showCharacterSheet()">' + 
                    'üë§ ' + currentCharacter.name + 
                    '</button>';
            
                inventoryInfo.innerHTML = '<button class="button" onclick="showInventory()">üéí –û—Ç–∫—Ä—ã—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>';
       
       // –∫–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Å—Ä–∞–∑—É –≤ –º–µ–Ω—é
       //   if (currentCharacter) {
       //       characterInfo.innerHTML = 
       //          '<button class="button" onclick="showCharacterSheet()">' + 
       //           'üë§ ' + currentCharacter.name + 
       //           '</button>' +
       //           '<button class="button secondary" onclick="deleteCharacter()" style="margin-top: 8px;">' +
       //           'üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞' +
       //           '</button>';

       //        inventoryInfo.innerHTML = '<button class="button" onclick="showInventory()">üéí –û—Ç–∫—Ä—ã—Ç—å –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>';
                
            } else {
                characterInfo.innerHTML = '<p>–ü–µ—Ä—Å–æ–Ω–∞–∂ –Ω–µ —Å–æ–∑–¥–∞–Ω</p>';
                inventoryInfo.innerHTML = '<p>–ü–µ—Ä—Å–æ–Ω–∞–∂ –Ω–µ —Å–æ–∑–¥–∞–Ω</p>';
            }

            var sceneInfo = document.getElementById('current-scene');
            if (sessionData.scene) {
                sceneInfo.innerHTML = '<p>' + sessionData.scene + '</p>';
            } else {
                sceneInfo.innerHTML = '<p>–°—Ü–µ–Ω–∞ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞</p>';
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ª–∏—Å—Ç –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä)
        function showCharacterSheet() {
            hideAllScreens();
            document.getElementById('character-creation').classList.remove('hidden');
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤—Å–µ –ø–æ–ª—è –¥–∞–Ω–Ω—ã–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            document.getElementById('char-name').value = currentCharacter.name;
            document.getElementById('char-ancestry').value = currentCharacter.ancestry;
            document.getElementById('char-background').value = currentCharacter.background || '';
            document.getElementById('char-class').value = currentCharacter.class;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥–µ–Ω–¥–µ—Ä
            var genderRadios = document.getElementsByName('gender');
            for (var i = 0; i < genderRadios.length; i++) {
                genderRadios[i].checked = (genderRadios[i].value === currentCharacter.gender);
            }
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
            document.getElementById('strength').value = currentCharacter.stats.strength;
            document.getElementById('agility').value = currentCharacter.stats.agility;
            document.getElementById('finesse').value = currentCharacter.stats.finesse;
            document.getElementById('instinct').value = currentCharacter.stats.instinct;
            document.getElementById('presence').value = currentCharacter.stats.presence;
            document.getElementById('knowledge').value = currentCharacter.stats.knowledge;
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞—â–∏—Ç—É
            document.getElementById('evasion').textContent = currentCharacter.evasion;
            document.getElementById('armor').textContent = currentCharacter.armor;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–æ–º–µ–Ω—ã
            updateDomainsDisplay();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç—Ä–µ–∫–∏
            updateLifeTrack(currentCharacter.hitPoints);
            updateDramaTrack(currentCharacter.dramaTrack);
            updateHopeTrack(currentCharacter.hopeTrack);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Ä—Ç—Ä–µ—Ç
            updatePortrait();
            
            // –î–µ–ª–∞–µ–º –≤—Å–µ –ø–æ–ª—è readonly
            makeFieldsReadonly();
            
            // –ú–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            updateCharacterSheetButtons();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–º–µ–Ω–æ–≤
        function updateDomainsDisplay() {
            if (currentCharacter && currentCharacter.domains) {
                var domain1Slot = document.getElementById('domain-1');
                var domain2Slot = document.getElementById('domain-2');
                
                // –ü–µ—Ä–≤—ã–π –¥–æ–º–µ–Ω
                if (currentCharacter.domains[0] && domainData[currentCharacter.domains[0]]) {
                    var domain1Data = domainData[currentCharacter.domains[0]];
                    domain1Slot.querySelector('.domain-icon').src = domain1Data.icon;
                    domain1Slot.querySelector('.domain-name').textContent = domain1Data.name;
                }
                
                // –í—Ç–æ—Ä–æ–π –¥–æ–º–µ–Ω
                if (currentCharacter.domains[1] && domainData[currentCharacter.domains[1]]) {
                    var domain2Data = domainData[currentCharacter.domains[1]];
                    domain2Slot.querySelector('.domain-icon').src = domain2Data.icon;
                    domain2Slot.querySelector('.domain-name').textContent = domain2Data.name;
                }
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–µ–∫–∞ –Ω–∞–¥–µ–∂–¥—ã
        function updateHopeTrack(filledCount) {
            var hopeTrack = document.getElementById('hope-track');
            var boxes = hopeTrack.querySelectorAll('.track-box');
            
            for (var i = 0; i < boxes.length; i++) {
                if (i < filledCount) {
                    boxes[i].classList.remove('empty');
                    boxes[i].classList.add('filled');
                } else {
                    boxes[i].classList.remove('filled');
                    boxes[i].classList.add('empty');
                }
            }
        }

        // –î–µ–ª–∞–µ—Ç –≤—Å–µ –ø–æ–ª—è —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è
        function makeFieldsReadonly() {
            document.getElementById('char-name').readOnly = true;
            document.getElementById('char-ancestry').disabled = true;
            document.getElementById('char-background').disabled = true;
            document.getElementById('char-class').disabled = true;
            
            var genderRadios = document.getElementsByName('gender');
            for (var i = 0; i < genderRadios.length; i++) {
                genderRadios[i].disabled = true;
            }
        }

        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–µ–π
        function makeFieldsEditable() {
            document.getElementById('char-name').readOnly = false;
            document.getElementById('char-ancestry').disabled = false;
            document.getElementById('char-background').disabled = false;
            document.getElementById('char-class').disabled = false;
            
            var genderRadios = document.getElementsByName('gender');
            for (var i = 0; i < genderRadios.length; i++) {
                genderRadios[i].disabled = false;
            }
        }

        // –û–±–Ω–æ–≤–ª—è–µ—Ç –∫–Ω–æ–ø–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞ (—Å–æ–∑–¥–∞–Ω–∏–µ/–ø—Ä–æ—Å–º–æ—Ç—Ä)
        function updateCharacterSheetButtons() {
            var buttonContainer = document.querySelector('#character-creation .card');
            var existingButtons = buttonContainer.querySelectorAll('.button');
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–Ω–æ–ø–∫–∏
            for (var i = existingButtons.length - 1; i >= 0; i--) {
                existingButtons[i].remove();
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            var editButton = document.createElement('button');
            editButton.className = 'button';
            editButton.onclick = editCharacter;
            editButton.innerHTML = '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
            
            var deleteButton = document.createElement('button');
            deleteButton.className = 'button secondary';
            deleteButton.onclick = deleteCharacter;
            deleteButton.innerHTML = 'üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞';
            
            var backButton = document.createElement('button');
            backButton.className = 'button secondary';
            backButton.onclick = showSession;
            backButton.innerHTML = '‚Üê –ù–∞–∑–∞–¥';
            
            buttonContainer.appendChild(editButton);
            buttonContainer.appendChild(deleteButton);
            buttonContainer.appendChild(backButton);
        }

        // –§—É–Ω–∫—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        function editCharacter() {
            makeFieldsEditable();
            
            // –ú–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            var buttonContainer = document.querySelector('#character-creation .card');
            var existingButtons = buttonContainer.querySelectorAll('.button');
            
            // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –∫–Ω–æ–ø–∫–∏
            for (var i = existingButtons.length - 1; i >= 0; i--) {
                existingButtons[i].remove();
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            var saveButton = document.createElement('button');
            saveButton.className = 'button';
            saveButton.onclick = saveCharacter;
            saveButton.innerHTML = '‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
            
            var cancelButton = document.createElement('button');
            cancelButton.className = 'button secondary';
            cancelButton.onclick = showCharacterSheet;
            cancelButton.innerHTML = '‚ùå –û—Ç–º–µ–Ω–∏—Ç—å';
            
            buttonContainer.appendChild(saveButton);
            buttonContainer.appendChild(cancelButton);
        }

        // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        function deleteCharacter() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–∂–∞?')) {
                currentCharacter = null;
                if (typeof(Storage) !== "undefined") {
                    localStorage.removeItem('daggerheart_character');
                }
                updateMenuButtons();
                showSession();
            }
        }

        function showInventory() {
            hideAllScreens();
            document.getElementById('inventory').classList.remove('hidden');
            loadInventoryItems();
        }
        
        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± —ç–∫–∏–ø–∏—Ä–æ–≤–∫–µ
        function showInventoryMessage() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
            var modal = document.getElementById('stats-notification-modal');
            var title = modal.querySelector('.notification-title');
            var text = modal.querySelector('.notification-text');

            modal.style.display = 'block';
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞–ª–∏—á–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏ –∏–≥—Ä—ã
        function updateMenuButtons() {
            var gameButton = document.getElementById('game-button');
            var sessionButton = document.getElementById('session-button');
            
            if (currentCharacter) {
                // –ü–µ—Ä—Å–æ–Ω–∞–∂ —Å–æ–∑–¥–∞–Ω - –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –æ–±–µ –∫–Ω–æ–ø–∫–∏
                gameButton.className = 'button';
                gameButton.disabled = false;
                sessionButton.className = 'button';
                sessionButton.disabled = false;
            } else {
                // –ü–µ—Ä—Å–æ–Ω–∞–∂–∞ –Ω–µ—Ç - –¥–µ–ª–∞–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º–∏
                gameButton.className = 'button secondary';
                gameButton.disabled = false; // –û—Å—Ç–∞–≤–ª—è–µ–º –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–π –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
                sessionButton.className = 'button secondary';
                sessionButton.disabled = false; // –û—Å—Ç–∞–≤–ª—è–µ–º –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–π –¥–ª—è –ø–æ–∫–∞–∑–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            }
        }

        async function startGame() {
            if (!currentCharacter) {
                alert('–î–ª—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã —Å–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞');
                return;
            }
            
            hideAllScreens();
            document.getElementById('game-screen').classList.remove('hidden');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–≥—Ä—É
            await initializeGame();
        }

        async function initializeGame() {
            addToGameLog('system', '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ò–ò –≥–µ–π–º-–º–∞—Å—Ç–µ—Ä—É...');
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/gm_action`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: '–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É',
                        character: currentCharacter,
                        game_state: gameState
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    updateGameScreen(result.data);
                    addToGameLog('system', '‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ì–ú —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
                } else {
                    addToGameLog('system', `‚ùå –û—à–∏–±–∫–∞ –ì–ú: ${result.error}`);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                addToGameLog('system', '‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ì–ú');
            }
        }

        async function sendPlayerAction() {
            const actionText = document.getElementById('player-action').value.trim();
            if (!actionText) return;
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
            const sendBtn = document.getElementById('send-action-btn');
            sendBtn.disabled = true;
            sendBtn.textContent = '‚è≥ –û–±—Ä–∞–±–æ—Ç–∫–∞...';
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ –≤ –ª–æ–≥
            addToGameLog('player', actionText);
            document.getElementById('player-action').value = '';
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/gm_action`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: actionText,
                        character: currentCharacter,
                        game_state: gameState
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    updateGameScreen(result.data);
                    
                    // –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –±—Ä–æ—Å–æ–∫, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –µ–≥–æ
                    if (result.data.requires_roll) {
                        await handleSkillCheck(result.data.requires_roll);
                    }
                } else {
                    addToGameLog('system', `‚ùå –û—à–∏–±–∫–∞ –ì–ú: ${result.error}`);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–µ–π—Å—Ç–≤–∏—è:', error);
                addToGameLog('system', '‚ùå –û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å –ì–ú');
            } finally {
                // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
                sendBtn.disabled = false;
                sendBtn.textContent = 'üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ';
            }
        }

        async function handleSkillCheck(rollData) {
            const trait = rollData.trait;
            const difficulty = rollData.difficulty;
            const reason = rollData.reason;
            
            addToGameLog('system', `üé≤ –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ ${trait} (—Å–ª–æ–∂–Ω–æ—Å—Ç—å ${difficulty}): ${reason}`);
            
            // –ü–æ–ª—É—á–∞–µ–º –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
            const traitModifier = currentCharacter.stats[trait] || 0;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/roll_dice`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        trait_modifier: traitModifier
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    displayDiceResult(result.data, difficulty);
                } else {
                    addToGameLog('system', '‚ùå –û—à–∏–±–∫–∞ –±—Ä–æ—Å–∫–∞ –∫—É–±–∏–∫–æ–≤');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –±—Ä–æ—Å–∫–∞:', error);
                addToGameLog('system', '‚ùå –û—à–∏–±–∫–∞ —Å–∏—Å—Ç–µ–º—ã –±—Ä–æ—Å–∫–æ–≤');
            }
        }

        function displayDiceResult(rollData, difficulty) {
            const { hope_dice, fear_dice, modifier, total, is_critical, dominant_die } = rollData;
            
            let resultText = `üé≤ –†–µ–∑—É–ª—å—Ç–∞—Ç: –ù–∞–¥–µ–∂–¥–∞ ${hope_dice}, –°—Ç—Ä–∞—Ö ${fear_dice}`;
            if (modifier !== 0) {
                resultText += ` + ${modifier} = ${total}`;
            }
            
            let outcome;
            if (is_critical) {
                outcome = 'üåü –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –£–°–ü–ï–•!';
            } else if (total >= difficulty) {
                outcome = dominant_die === 'hope' ? 
                    '‚úÖ –£—Å–ø–µ—Ö —Å –ù–∞–¥–µ–∂–¥–æ–π!' : 
                    '‚úÖ –£—Å–ø–µ—Ö —Å–æ –°—Ç—Ä–∞—Ö–æ–º';
            } else {
                outcome = '‚ùå –ù–µ—É–¥–∞—á–∞';
            }
            
            addToGameLog('system', `${resultText}\n${outcome}`);
        }

        function updateGameScreen(gmData) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã
            if (gmData.scene_description) {
                addToGameLog('gm', gmData.scene_description);
                gameState.scene = gmData.scene_description;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞—Ü–∏—é
            if (gmData.location) {
                document.getElementById('scene-location').textContent = gmData.location;
                gameState.location = gmData.location;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π
            if (gmData.action_suggestions) {
                updateActionSuggestions(gmData.action_suggestions);
            }
        }

        function updateActionSuggestions(suggestions) {
            const container = document.getElementById('suggestions-list');
            container.innerHTML = '';
            
            suggestions.forEach(suggestion => {
                const button = document.createElement('button');
                button.className = 'button secondary';
                button.style.marginBottom = '4px';
                button.textContent = suggestion;
                button.onclick = () => {
                    document.getElementById('player-action').value = suggestion;
                };
                container.appendChild(button);
            });
            
            document.getElementById('action-suggestions').classList.remove('hidden');
        }

        function addToGameLog(type, content) {
            const gameLog = document.getElementById('game-log');
            const messageDiv = document.createElement('div');
            messageDiv.className = `${type}-message`;
            
            const prefixes = {
                'gm': 'üé≠ –ì–ú:',
                'player': 'üë§ –í—ã:',
                'system': '‚öôÔ∏è –°–∏—Å—Ç–µ–º–∞:'
            };
            
            messageDiv.innerHTML = `<strong>${prefixes[type]}</strong> ${content.replace(/\n/g, '<br>')}`;
            
            gameLog.appendChild(messageDiv);
            gameLog.scrollTop = gameLog.scrollHeight;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
            gameState.log.push({type, content, timestamp: Date.now()});
        }

        async function quickRoll(trait) {
            if (!currentCharacter) return;
            
            const traitModifier = currentCharacter.stats[trait] || 0;
            const traitNames = {
                'strength': '–°–∏–ª–∞',
                'agility': '–õ–æ–≤–∫–æ—Å—Ç—å', 
                'finesse': '–ì—Ä–∞—Ü–∏—è',
                'instinct': '–ò–Ω—Ç—É–∏—Ü–∏—è',
                'presence': '–•–∞—Ä–∏–∑–º–∞',
                'knowledge': '–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç'
            };
            
            addToGameLog('player', `–ë—Ä–æ—Å–∞—é –ø—Ä–æ–≤–µ—Ä–∫—É ${traitNames[trait]}`);
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/roll_dice`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        trait_modifier: traitModifier
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const { hope_dice, fear_dice, modifier, total } = result.data;
                    addToGameLog('system', `üé≤ ${traitNames[trait]}: –ù–∞–¥–µ–∂–¥–∞ ${hope_dice}, –°—Ç—Ä–∞—Ö ${fear_dice} + ${modifier} = ${total}`);
                }
                
            } catch (error) {
                addToGameLog('system', '‚ùå –û—à–∏–±–∫–∞ –±—Ä–æ—Å–∫–∞');
            }
        }

        function pauseGame() {
            addToGameLog('system', '‚è∏Ô∏è –ò–≥—Ä–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
        }

        function endGame() {
            if (confirm('–ó–∞–≤–µ—Ä—à–∏—Ç—å –∏–≥—Ä—É?')) {
                showMainMenu();
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('load', function() {
            console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ');
        });
    </script>
</body>
</html>